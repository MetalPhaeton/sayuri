<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sayuri: chess_engine_search.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sayuri_logo130x65.svg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sayuri
   </div>
   <div id="projectbrief">UCI用チェスエンジン</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('chess__engine__search_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">chess_engine_search.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="chess__engine__search_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* The MIT License (MIT)</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (c) 2014 Hironori Ishibashi</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * of this software and associated documentation files (the &quot;Software&quot;), to</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * deal in the Software without restriction, including without limitation the</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * sell copies of the Software, and to permit persons to whom the Software is</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * The above copyright notice and this permission notice shall be included in</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * all copies or substantial portions of the Software.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * IN THE SOFTWARE.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * @file chess_engine_search.cpp</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * @author Hironori Ishibashi</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * @brief チェスエンジンの本体の実装。 (探索関数)</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="chess__engine_8h.html">chess_engine.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;cstddef&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common_8h.html">common.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="transposition__table_8h.html">transposition_table.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="move__maker_8h.html">move_maker.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pv__line_8h.html">pv_line.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="evaluator_8h.html">evaluator.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="uci__shell_8h.html">uci_shell.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="position__record_8h.html">position_record.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="job_8h.html">job.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="helper__queue_8h.html">helper_queue.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="params_8h.html">params.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">/** Sayuri 名前空間。 */</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">namespace </span>Sayuri {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// クイース探索。</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a03be4cdf1a664340c47825a5a074fcba">   55</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a03be4cdf1a664340c47825a5a074fcba">ChessEngine::Quiesce</a>(<span class="keywordtype">int</span> depth, std::uint32_t level, <span class="keywordtype">int</span> alpha, <span class="keywordtype">int</span> beta,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordtype">int</span> material, <a class="code" href="classSayuri_1_1TranspositionTable.html">TranspositionTable</a>&amp; table) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// 探索中止の時。</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">return</span> alpha;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// ノード数を加算。</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_++;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// 最大探索数。</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span> (level &gt; <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a>) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a> = level;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// サイド。</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> side = <a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> enemy_side = side ^ 0x3;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// stand_pad。</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordtype">int</span> stand_pad = <a class="code" href="classSayuri_1_1ChessEngine.html#a2be52e947e9300f51ff75cd165df3869">evaluator_</a>.<a class="code" href="classSayuri_1_1Evaluator.html#a3dc6779fd59a6cf84e7c620e16a80d8c">Evaluate</a>(material);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// アルファ値、ベータ値を調べる。</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> (stand_pad &gt;= beta) {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="keywordflow">return</span> beta;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (stand_pad &gt; alpha) {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      alpha = stand_pad;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// 探索できる限界を超えているか。</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// 超えていればこれ以上探索しない。</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">if</span> (level &gt;= <a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a>) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">return</span> alpha;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// 候補手を作る。</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// 駒を取る手だけ。</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="classSayuri_1_1MoveMaker.html">MoveMaker</a>&amp; maker = <a class="code" href="classSayuri_1_1ChessEngine.html#af71ab02647f022503ca25fa4fdad4171">maker_table_</a>[level];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side)) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a30fa735ffc2c71e492dbc9ab08d41f3f">GenMoves</a>&lt;<a class="code" href="namespaceSayuri.html#a38eace0fcb969cf644905fc3ff641791a5fb1f955b45e38e31789286a1790398d">GenMoveType::ALL</a>&gt;(0, 0, 0, 0);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a30fa735ffc2c71e492dbc9ab08d41f3f">GenMoves</a>&lt;<a class="code" href="namespaceSayuri.html#a38eace0fcb969cf644905fc3ff641791ab72f08e0732365cac9599b5c42157bf9">GenMoveType::CAPTURE</a>&gt;(0, 0, 0, 0);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// 探索する。</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">int</span> margin = <a class="code" href="classSayuri_1_1ChessEngine.html#ab6de10e62ba98e31866ba8fe6d31b083">GetMargin</a>(depth);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// --- Futility Pruning --- //</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordtype">bool</span> enable_futility_pruning =</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_futility_pruning();</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> move = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a6bdf60598f4330a006bf8f357f4070ec">PickMove</a>(); move; move = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a6bdf60598f4330a006bf8f357f4070ec">PickMove</a>()) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="comment">// 次の自分のマテリアル。</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keywordtype">int</span> next_my_material = <a class="code" href="classSayuri_1_1ChessEngine.html#a2f5a30e39ceb33d59e7258e55b1b87a8">GetNextMyMaterial</a>(material, move);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">MakeMove</a>(move);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="comment">// 合法手かどうか調べる。</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side)) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="comment">// Futility Pruning。</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">if</span> (enable_futility_pruning) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span> ((next_my_material + margin) &lt;= alpha) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;          <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      }</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="comment">// 次の手を探索。</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordtype">int</span> score = -<a class="code" href="classSayuri_1_1ChessEngine.html#a03be4cdf1a664340c47825a5a074fcba">Quiesce</a>(depth - 1, level + 1, -beta, -alpha,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      -next_my_material, table);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="comment">// アルファ値、ベータ値を調べる。</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keywordflow">if</span> (score &gt; alpha) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        alpha = score;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">if</span> (score &gt;= beta) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        alpha = beta;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">return</span> alpha;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// 通常の探索。</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keyword">template</span>&lt;NodeType Type&gt;</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a52fbdc182f7015fd9069fa616666ee80">  146</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a52fbdc182f7015fd9069fa616666ee80">ChessEngine::Search</a>(<a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> pos_hash, <span class="keywordtype">int</span> depth, std::uint32_t level,</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordtype">int</span> alpha, <span class="keywordtype">int</span> beta, <span class="keywordtype">int</span> material, <a class="code" href="classSayuri_1_1TranspositionTable.html">TranspositionTable</a>&amp; table) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// 探索中止の時。</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">return</span> alpha;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// ノード数を加算。</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_++;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// 最大探索数。</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (level &gt; <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a>) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a> = level;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// サイドとチェックされているか。</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> side = <a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> enemy_side = side ^ 0x3;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordtype">bool</span> is_checked = <a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// PVLineをリセット。</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].ResetLine();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// --- トランスポジションテーブル --- //</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> prev_best = 0;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_ttable()) {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      table.<a class="code" href="classSayuri_1_1TranspositionTable.html#ab32fdced7f734a081a189f96de0cb2ba">Lock</a>();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="comment">// 前回の繰り返しの最善手を得る。</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keyword">const</span> <a class="code" href="classSayuri_1_1TTEntry.html">TTEntry</a>&amp; prev_entry = table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a83ac19bead10741ecbb6b0f89c6975b1">GetEntry</a>(pos_hash, depth - 1);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">if</span> (prev_entry &amp;&amp; (prev_entry.<a class="code" href="classSayuri_1_1TTEntry.html#aaa65f55176f09aedcafbbf4279eb606b">score_type</a>() != <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87">ScoreType::ALPHA</a>)) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        prev_best = prev_entry.<a class="code" href="classSayuri_1_1TTEntry.html#a1818c23afb991c0e7d666cd789256c56">best_move</a>();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="comment">// 局面の繰り返し対策などのため、</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="comment">// 自分の初手と相手の初手の場合(level &lt; 2の場合)は参照しない。</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="comment">// 前回の繰り返しの最善手を得る。</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> (level &gt;= 2) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keyword">const</span> <a class="code" href="classSayuri_1_1TTEntry.html">TTEntry</a>&amp; tt_entry = table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a83ac19bead10741ecbb6b0f89c6975b1">GetEntry</a>(pos_hash, depth);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">if</span> (tt_entry) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          <span class="keywordtype">int</span> score = tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#a74f052774cdd9684070eec2dd6d2f22d">score</a>();</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          <span class="keywordflow">if</span> (tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#aaa65f55176f09aedcafbbf4279eb606b">score_type</a>() == <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34ac41e056424136b6e8c4e23dd6326efa1">ScoreType::EXACT</a>) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="comment">// エントリーが正確な値。</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> best_move = tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#a1818c23afb991c0e7d666cd789256c56">best_move</a>();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordflow">if</span> (!(tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#a1818c23afb991c0e7d666cd789256c56">best_move</a>() &amp; <a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a>)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            &amp;&amp; (level &lt; <a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a>)) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;              <span class="comment">// キラームーブをセット。</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer()) {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][0] = best_move;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer_2()) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                  <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level + 2][1] = best_move;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;              }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].mate_in(tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#aabcd97fbc778dce0c2bcbc46ede8cd6f">mate_in</a>());</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">if</span> (score &gt;= beta) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(beta);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;              table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Unlock</a>();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;              <span class="keywordflow">return</span> beta;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">if</span> (score &lt;= alpha) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(alpha);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;              table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Unlock</a>();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;              <span class="keywordflow">return</span> alpha;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(score);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Unlock</a>();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">return</span> score;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#aaa65f55176f09aedcafbbf4279eb606b">score_type</a>() == <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87">ScoreType::ALPHA</a>) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="comment">// エントリーがアルファ値。</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">if</span> (score &lt;= alpha) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;              <span class="comment">// アルファ値以下が確定。</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(alpha);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].mate_in(tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#aabcd97fbc778dce0c2bcbc46ede8cd6f">mate_in</a>());</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;              table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Unlock</a>();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;              <span class="keywordflow">return</span> alpha;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="comment">// ベータ値を下げられる。</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">if</span> (score &lt; beta) beta = score + 1;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="comment">// エントリーがベータ値。</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> best_move = tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#a1818c23afb991c0e7d666cd789256c56">best_move</a>();</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="keywordflow">if</span> (!(tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#a1818c23afb991c0e7d666cd789256c56">best_move</a>() &amp; <a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a>)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            &amp;&amp; (level &lt; <a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a>)) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;              <span class="comment">// キラームーブをセット。</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer()) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][0] = best_move;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer_2()) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                  <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level + 2][1] = best_move;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;              }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordflow">if</span> (score &gt;= beta) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;              <span class="comment">// ベータ値以上が確定。</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(beta);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].mate_in(tt_entry.<a class="code" href="classSayuri_1_1TTEntry.html#aabcd97fbc778dce0c2bcbc46ede8cd6f">mate_in</a>());</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;              table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Unlock</a>();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;              <span class="keywordflow">return</span> beta;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="comment">// アルファ値を上げられる。</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">if</span> (score &gt; alpha) alpha = score - 1;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Unlock</a>();</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// 深さが0ならクイース。</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// 限界探索数を超えていてもクイース。</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> ((depth &lt;= 0) || (level &gt;= <a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a>)) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="comment">// クイース探索ノードに移行するため、ノード数を減らしておく。</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_--;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a03be4cdf1a664340c47825a5a074fcba">Quiesce</a>(depth, level, alpha, beta, material, table);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// --- Internal Iterative Deepening --- //</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (Type == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4aa565153df227b0510b1c789d5cdc39ec">NodeType::PV</a>) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_iid()) {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment">// 前回の繰り返しの最善手があればIIDしない。</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">if</span> (prev_best) {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;          <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;iid_stack_[level] = prev_best;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          <span class="keywordflow">if</span> (!is_checked &amp;&amp; (depth</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          &gt;= <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;iid_limit_depth())) {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="comment">// Internal Iterative Deepening。</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            Search&lt;NodeType::PV&gt;(pos_hash,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;iid_search_depth(), level,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            alpha, beta, material, table);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;iid_stack_[level] = <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level][0];</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// --- Null Move Reduction --- //</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordtype">int</span> null_reduction = 0;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> (Type == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">NodeType::NON_PV</a>) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_nmr()) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a> &amp;&amp; !is_checked &amp;&amp; (depth</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        &gt;= <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;nmr_limit_depth())) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          <span class="comment">// Null Move Reduction。</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          <a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> null_move = 0;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          <a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          <a class="code" href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">MakeMove</a>(null_move);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          <span class="comment">// Null Move Search。</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          <span class="keywordtype">int</span> score = -Search&lt;NodeType::NON_PV&gt;(pos_hash, depth</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          - <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;nmr_search_reduction() - 1,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          level + 1, -(beta), -(beta - 1), -material, table);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(null_move);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          <a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          <span class="keywordflow">if</span> (score &gt;= beta) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            null_reduction =</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;nmr_reduction();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            depth -= null_reduction;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordflow">if</span> ((depth &lt;= 0)) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;              <span class="comment">// クイース探索ノードに移行するため、ノード数を減らしておく。</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_--;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;              <span class="keywordflow">return</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a03be4cdf1a664340c47825a5a074fcba">Quiesce</a>(depth, level, alpha, beta, material, table);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// 手を作る。</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="classSayuri_1_1MoveMaker.html">MoveMaker</a>&amp; maker = <a class="code" href="classSayuri_1_1ChessEngine.html#af71ab02647f022503ca25fa4fdad4171">maker_table_</a>[level];</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a30fa735ffc2c71e492dbc9ab08d41f3f">GenMoves</a>&lt;<a class="code" href="namespaceSayuri.html#a38eace0fcb969cf644905fc3ff641791a5fb1f955b45e38e31789286a1790398d">GenMoveType::ALL</a>&gt;(prev_best,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;iid_stack_[level],</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][0],</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][1]);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// --- ProbCut --- //</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span> ((Type == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">NodeType::NON_PV</a>)) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_probcut()) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a> &amp;&amp; !is_checked &amp;&amp; (depth</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        &gt;= <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;probcut_limit_depth())) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          <span class="comment">// 手を作る。</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;          maker.<a class="code" href="classSayuri_1_1MoveMaker.html#ae11935acd1aa8933c47299c4b04d1e4d">RegenMoves</a>();</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <span class="comment">// 浅読みパラメータ。</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <span class="keywordtype">int</span> prob_beta =</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          beta + <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;probcut_margin();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          <span class="keywordtype">int</span> prob_depth = depth</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          - <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;probcut_search_reduction();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;          <span class="comment">// 探索。</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> move = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a6bdf60598f4330a006bf8f357f4070ec">PickMove</a>(); move; move = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a6bdf60598f4330a006bf8f357f4070ec">PickMove</a>()) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="comment">// 次のノードへの準備。</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> next_hash = <a class="code" href="classSayuri_1_1ChessEngine.html#a7e8b4b7a7a3520176b025bc6776ad9b3">GetNextHash</a>(pos_hash, move);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="keywordtype">int</span> next_my_material = <a class="code" href="classSayuri_1_1ChessEngine.html#a2f5a30e39ceb33d59e7258e55b1b87a8">GetNextMyMaterial</a>(material, move);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">MakeMove</a>(move);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="comment">// 合法手じゃなければ次の手へ。</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side)) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;              <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordtype">int</span> score = -Search&lt;NodeType::NON_PV&gt;(next_hash, prob_depth - 1,</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            level + 1, -prob_beta, -(prob_beta - 1), -next_my_material, table);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="comment">// ベータカット。</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">if</span> (score &gt;= prob_beta) {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;              <span class="comment">// PVライン。</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].SetMove(move);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].Insert(<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level + 1]);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;              <span class="comment">// 取らない手。</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;              <span class="keywordflow">if</span> (!(move &amp; <a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a>)) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                <span class="comment">// 手の情報を得る。</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> from = <a class="code" href="namespaceSayuri.html#ad9efed3eea6135b5ec505e10a92c9613">move_from</a>(move);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                <a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> to = <a class="code" href="namespaceSayuri.html#ab8e43a53c8ed41163b8855c6f68b0793">move_to</a>(move);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="comment">// キラームーブ。</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer()) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                  <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][0] = move;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer_2()) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level + 2][1] = move;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                  }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="comment">// ヒストリー。</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_history()) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                  <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to] += depth * depth;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to]</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                  &gt; <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_ =</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to];</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                  }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;              }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;              <span class="comment">// トランスポジションテーブルに登録。</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;              <span class="comment">// Null Move Reductionされていた場合、容量節約のため登録しない。</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_ttable()) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <span class="keywordflow">if</span> (!null_reduction &amp;&amp; !<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                  table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a7be71ee1c0ac1896e45f14abb91f1757">Add</a>(pos_hash, depth, beta, <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a36b84f8e3fba5bf993e3ba352d62d146">ScoreType::BETA</a>,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                  <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level][0], <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].mate_in());</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;              }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;              <span class="keywordflow">return</span> beta;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">// --- Check Extension --- //</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">if</span> (is_checked) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      depth += 1;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// 準備。</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordtype">int</span> num_all_moves = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#ae11935acd1aa8933c47299c4b04d1e4d">RegenMoves</a>();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">int</span> num_moves = 0;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34">ScoreType</a> score_type = <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87">ScoreType::ALPHA</a>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordtype">bool</span> has_legal_move = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordtype">int</span> margin = <a class="code" href="classSayuri_1_1ChessEngine.html#ab6de10e62ba98e31866ba8fe6d31b083">GetMargin</a>(depth);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// 仕事の生成。</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    std::mutex mutex;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="classSayuri_1_1PositionRecord.html">PositionRecord</a> record(*<span class="keyword">this</span>);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <a class="code" href="classSayuri_1_1Job.html">Job</a>&amp; job = <a class="code" href="classSayuri_1_1ChessEngine.html#a197c8c14759ad6bc79ba39078287686b">job_table_</a>[level];</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#ab51c5b67b3383c433f81c78f05f2d293">Init</a>(maker);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a> = &amp;mutex;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a558bb7e4ff6ee816782fdddc3c37bc33">record_ptr_</a> = &amp;record;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#ab3eab4889a014d2c5d87a654e300ac15">node_type_</a> = Type;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a2667b5609b3ff070c3ddf1e44b8c3c02">pos_hash_</a> = pos_hash;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> = depth;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> = level;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a> = &amp;alpha;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a> = &amp;beta;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a> = &amp;table;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a> = &amp;<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level];</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a54db0b050b89681483356f05a9659f6d">is_null_searching_</a> = <a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#ad0caeeb84ca86f74568338ad85644555">null_reduction_</a> = null_reduction;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#aec295bc1d2ddb9afbdaed175ed64f0fd">score_type_ptr_</a> = &amp;score_type;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a02f609a81a57ad7473d2f95f0d25475c">material_</a> = material;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a3f0219a378f20611724f9626aece42c0">is_checked_</a> = is_checked;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#a61730bd1bbc2dcca36708950aa8b84b5">num_all_moves_</a> = num_all_moves;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#abf7fa1f0f9379ea036b1ae3049f5ae7b">has_legal_move_ptr_</a> = &amp;has_legal_move;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// パラメータ保存。</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// YBWC。</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">int</span> ybwc_after_moves =</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;ybwc_after_moves();</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">int</span> ybwc_limit_depth =</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;ybwc_limit_depth();</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// History Pruning。</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordtype">bool</span> enable_history_pruning =</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_history_pruning();</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordtype">int</span> history_pruning_limit_depth =</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_limit_depth();</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordtype">int</span> history_pruning_move_threshold = num_all_moves *</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_move_threshold();</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">int</span> history_pruning_after_moves =</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_after_moves();</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    history_pruning_move_threshold =</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    history_pruning_move_threshold &lt; history_pruning_after_moves </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    ? history_pruning_after_moves : history_pruning_move_threshold;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    std::uint64_t history_pruning_threshold = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    * <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_threshold();</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">int</span> history_pruning_reduction =</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_reduction();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// Late Move Reduction。</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordtype">bool</span> enable_lmr = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_lmr();</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordtype">int</span> lmr_limit_depth =</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_limit_depth();</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordtype">int</span> lmr_threshold = num_all_moves</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    * <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_threshold();</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordtype">int</span> lmr_after_moves =</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_after_moves();</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    lmr_threshold =</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    lmr_threshold &lt; lmr_after_moves ? lmr_after_moves : lmr_threshold;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">int</span> lmr_search_reduction =</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_search_reduction();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// Futility Pruning。</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">bool</span> enable_futility_pruning =</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_futility_pruning();</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordtype">int</span> futility_pruning_depth =</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;futility_pruning_depth();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> move = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a6bdf60598f4330a006bf8f357f4070ec">PickMove</a>(); move; move = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a6bdf60598f4330a006bf8f357f4070ec">PickMove</a>()) {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">// すでにベータカットされていればループを抜ける。</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordflow">if</span> (alpha &gt;= beta) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="comment">// 別スレッドに助けを求める。(YBWC)</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keywordflow">if</span> ((depth &gt;= ybwc_limit_depth) &amp;&amp; (num_moves &gt; ybwc_after_moves)) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;helper_queue_ptr_-&gt;Help(job);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="comment">// 次のハッシュ。</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> next_hash = <a class="code" href="classSayuri_1_1ChessEngine.html#a7e8b4b7a7a3520176b025bc6776ad9b3">GetNextHash</a>(pos_hash, move);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="comment">// 次の自分のマテリアル。</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordtype">int</span> next_my_material = <a class="code" href="classSayuri_1_1ChessEngine.html#a2f5a30e39ceb33d59e7258e55b1b87a8">GetNextMyMaterial</a>(material, move);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">MakeMove</a>(move);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="comment">// 合法手じゃなければ次の手へ。</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side)) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="comment">// 合法手があったのでフラグを立てる。</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      has_legal_move = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      num_moves = job.<a class="code" href="classSayuri_1_1Job.html#a42dbbaccf84063521f4820bbe1b1e990">Count</a>();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="comment">// -- Futility Pruning --- //</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">if</span> (enable_futility_pruning) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">if</span> (depth &lt;= futility_pruning_depth) {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;          <span class="keywordflow">if</span> ((next_my_material + margin) &lt;= alpha) {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;          }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="comment">// 手の情報を得る。</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> from = <a class="code" href="namespaceSayuri.html#ad9efed3eea6135b5ec505e10a92c9613">move_from</a>(move);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> to = <a class="code" href="namespaceSayuri.html#ab8e43a53c8ed41163b8855c6f68b0793">move_to</a>(move);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">// 探索。</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordtype">int</span> score = 0;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordtype">int</span> temp_alpha = alpha;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordtype">int</span> temp_beta = beta;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordtype">int</span> new_depth = depth;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="comment">// History PruningとLate Move Reductionの共通条件。</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordtype">bool</span> is_hp_or_lmr_ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">if</span> (!is_checked &amp;&amp; !null_reduction</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      &amp;&amp; !(move &amp; (<a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a> | <a class="code" href="namespaceSayuri.html#a6069d68a000c2a664d6530acbe419e88">PROMOTION_MASK</a>))</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      &amp;&amp; !<a class="code" href="namespaceSayuri.html#ac2075b4a679c5046b4581194d3c41d77">EqualMove</a>(move, <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][0])</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      &amp;&amp; !<a class="code" href="namespaceSayuri.html#ac2075b4a679c5046b4581194d3c41d77">EqualMove</a>(move, <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][1])) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        is_hp_or_lmr_ok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="comment">// --- History Pruning --- //</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">if</span> (Type == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">NodeType::NON_PV</a>) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">if</span> (enable_history_pruning) {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;          <span class="keywordflow">if</span> (is_hp_or_lmr_ok &amp;&amp; (new_depth &gt;= history_pruning_limit_depth)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          &amp;&amp; (num_moves &gt; history_pruning_move_threshold)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          &amp;&amp; (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to]</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;          &lt; history_pruning_threshold)) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            new_depth -= history_pruning_reduction;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;          }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="comment">// --- Late Move Reduction --- //</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">if</span> (enable_lmr) {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">if</span> (is_hp_or_lmr_ok &amp;&amp; (new_depth &gt;= lmr_limit_depth)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        &amp;&amp; (num_moves &gt; lmr_threshold)) {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          score = -Search&lt;NodeType::NON_PV&gt;(next_hash,</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          new_depth - lmr_search_reduction - 1, level + 1, -(temp_alpha + 1),</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          -temp_alpha, -next_my_material, table);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          <span class="comment">// PVSearchをするためにtemp_alphaより大きくしておく。</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          score = temp_alpha + 1;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="comment">// PVSearchをするためにtemp_alphaより大きくしておく。</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        score = temp_alpha + 1;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">if</span> (score &gt; temp_alpha) {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="comment">// --- PVSearch --- //</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">if</span> ((num_moves &lt;= 1) || (Type == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">NodeType::NON_PV</a>)) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;          <span class="comment">// フルウィンドウで探索。</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          score = -Search&lt;Type&gt;(next_hash, new_depth - 1, level + 1,</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          -temp_beta, -temp_alpha, -next_my_material, table);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;          <span class="comment">// PV発見後のPVノード。</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          <span class="comment">// ゼロウィンドウ探索。</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;          score = -Search&lt;NodeType::NON_PV&gt;(next_hash, new_depth - 1,</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;          level + 1, -(temp_alpha + 1), -temp_alpha, -next_my_material, table);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          <span class="keywordflow">if</span> (score &gt; temp_alpha) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="comment">// fail lowならず。</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="comment">// フルウィンドウで再探索。</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            score = -Search&lt;NodeType::PV&gt;(next_hash, new_depth - 1, level + 1,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            -temp_beta, -temp_alpha, -next_my_material, table);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="comment">// 同じ局面の繰り返しは0点。</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">if</span> (level &lt;= 1) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="classSayuri_1_1ChessEngine.html#a5ecb413f5ccfb0e8b80a7385e90e5e44">position</a> : <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;position_history_) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a5ecb413f5ccfb0e8b80a7385e90e5e44">position</a> == *<span class="keyword">this</span>) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            score = <a class="code" href="namespaceSayuri.html#a603f7001236671f9f6552d6e78719033">SCORE_DRAW</a>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      mutex.lock();  <span class="comment">// ロック。</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="comment">// アルファ値を更新。</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="keywordflow">if</span> (score &gt; alpha) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="comment">// 評価値のタイプをセット。</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">if</span> (score_type == <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87">ScoreType::ALPHA</a>) {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          score_type = <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34ac41e056424136b6e8c4e23dd6326efa1">ScoreType::EXACT</a>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="comment">// PVライン。</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].SetMove(move);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].Insert(<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level + 1]);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        alpha = score;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="comment">// ベータ値を調べる。</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="keywordflow">if</span> (score &gt;= beta) {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="comment">// 評価値の種類をセット。</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        score_type = <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a36b84f8e3fba5bf993e3ba352d62d146">ScoreType::BETA</a>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="comment">// 取らない手。</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span> (!(move &amp; <a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a>)) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          <span class="comment">// キラームーブ。</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer()) {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][0] = move;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer_2()) {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level + 2][1] = move;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;          }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <span class="comment">// ヒストリー。</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_history()) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to] += depth * depth;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to]</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            &gt; <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_ =</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to];</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          }</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        }</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="comment">// ベータカット。</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        mutex.unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        alpha = beta;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      mutex.unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">// スレッドを合流。</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#ab72697ada209d19270bf7dc5f84c79d1">WaitForHelpers</a>();</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="comment">// このノードでゲーム終了だった場合。</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">if</span> (!has_legal_move) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordflow">if</span> (is_checked) {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">// チェックメイト。</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordtype">int</span> score = <a class="code" href="namespaceSayuri.html#a1ce75744f6f5181ad0ccd91286933e46">SCORE_LOSE</a>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordflow">if</span> (score &lt; alpha) score = alpha;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">if</span> (score &gt; beta) score = beta;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(score);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].mate_in(level);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">return</span> score;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="comment">// ステールメイト。</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordtype">int</span> score = <a class="code" href="namespaceSayuri.html#a603f7001236671f9f6552d6e78719033">SCORE_DRAW</a>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">if</span> (score &lt; alpha) score = alpha;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">if</span> (score &gt; beta) score = beta;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(score);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">return</span> score;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">// トランスポジションテーブルに登録。</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">// Null Move探索中の局面は登録しない。</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// Null Move Reductionされていた場合、容量節約のため登録しない。</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_ttable()) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a> &amp;&amp; !null_reduction &amp;&amp; !<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a7be71ee1c0ac1896e45f14abb91f1757">Add</a>(pos_hash, depth, alpha, score_type,</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level][0], <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].mate_in());</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">// 探索結果を返す。</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(alpha);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">return</span> alpha;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="comment">// 実体化。</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keyword">template</span> <span class="keywordtype">int</span> ChessEngine::Search&lt;NodeType::PV&gt;(<a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> pos_hash,</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordtype">int</span> depth, std::uint32_t level, <span class="keywordtype">int</span> alpha, <span class="keywordtype">int</span> beta, <span class="keywordtype">int</span> material,</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <a class="code" href="classSayuri_1_1TranspositionTable.html">TranspositionTable</a>&amp; table);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keyword">template</span> <span class="keywordtype">int</span> ChessEngine::Search&lt;NodeType::NON_PV&gt;(<a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> pos_hash,</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordtype">int</span> depth, std::uint32_t level, <span class="keywordtype">int</span> alpha, <span class="keywordtype">int</span> beta, <span class="keywordtype">int</span> material,</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <a class="code" href="classSayuri_1_1TranspositionTable.html">TranspositionTable</a>&amp; table);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="comment">// 探索のルート。</span></div>
<div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a45d63733887697a8101d8b83b46f9497">  710</a></span>&#160;  <a class="code" href="classSayuri_1_1PVLine.html">PVLine</a> <a class="code" href="classSayuri_1_1ChessEngine.html#a45d63733887697a8101d8b83b46f9497">ChessEngine::SearchRoot</a>(<a class="code" href="classSayuri_1_1TranspositionTable.html">TranspositionTable</a>&amp; table,</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keyword">const</span> std::vector&lt;Move&gt;&amp; moves_to_search, <a class="code" href="classSayuri_1_1UCIShell.html">UCIShell</a>&amp; shell) {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// --- 初期化 --- //</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a> = 0;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_ = 0;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;start_time_ = SysClock::now();</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> side = 0; side &lt; <a class="code" href="namespaceSayuri.html#a700a7b74ce454bde76fb21741f3c2178">NUM_SIDES</a>; side++) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> from = 0; from &lt; <a class="code" href="namespaceSayuri.html#aef4f257c997087612c93ac876b79ec63">NUM_SQUARES</a>; from++) {</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> to = 0; to &lt; <a class="code" href="namespaceSayuri.html#aef4f257c997087612c93ac876b79ec63">NUM_SQUARES</a>; to++) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;          <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to] = 0;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">for</span> (std::uint32_t i = 0; i &lt; (<a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a> + 1); i++) {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;iid_stack_[i] = 0;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[i][0] = 0;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[i][1] = 0;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[i + 2][0] = 0;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[i + 2][1] = 0;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#af71ab02647f022503ca25fa4fdad4171">maker_table_</a>[i].ResetStack();</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[i].ResetLine();</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#a197c8c14759ad6bc79ba39078287686b">job_table_</a>[i] = <a class="code" href="classSayuri_1_1Job.html">Job</a>();</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_ = 1;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;stop_now_ = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_ = 1;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// スレッドの準備。</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;helper_queue_ptr_.reset(<span class="keyword">new</span> <a class="code" href="classSayuri_1_1HelperQueue.html">HelperQueue</a>());</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; thread : <a class="code" href="classSayuri_1_1ChessEngine.html#ab2dabf8fe7d35b0e3d4b6cb617361602">thread_vec_</a>) {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      thread =</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      std::thread(&amp;<a class="code" href="classSayuri_1_1ChessEngine.html#a3ef155b7de31b9c28593f90f27036603">ChessEngine::ThreadYBWC</a>, <span class="keyword">this</span>, std::ref(shell));</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="comment">// --- Iterative Deepening --- //</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordtype">int</span> level = 0;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> pos_hash = <a class="code" href="classSayuri_1_1ChessEngine.html#a8bb1fc13b4ef9f8e9fc8f7a56d60e4d5">GetCurrentHash</a>();</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordtype">int</span> material = <a class="code" href="classSayuri_1_1ChessEngine.html#ad73cbf1f5d4e21f57265b0725e174611">GetMaterial</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordtype">int</span> alpha = -<a class="code" href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">MAX_VALUE</a>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordtype">int</span> beta = <a class="code" href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">MAX_VALUE</a>;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> side = <a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> enemy_side = side ^ 0x3;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <a class="code" href="namespaceSayuri.html#a08729a5deca223e833840c8b8e224b23">TimePoint</a> now = SysClock::now();</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <a class="code" href="namespaceSayuri.html#a08729a5deca223e833840c8b8e224b23">TimePoint</a> next_print_info_time = now + Chrono::milliseconds(1000);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <a class="code" href="classSayuri_1_1MoveMaker.html">MoveMaker</a>&amp; maker = <a class="code" href="classSayuri_1_1ChessEngine.html#af71ab02647f022503ca25fa4fdad4171">maker_table_</a>[level];</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordtype">bool</span> is_checked = <a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordtype">bool</span> found_mate = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_ = 1; <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_ &lt;= <a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_++) {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="comment">// 探索終了。</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="comment">// ノードを加算。</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_++;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="comment">// メイトをすでに見つけていたら探索しない。</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <span class="keywordflow">if</span> (found_mate) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        Chrono::milliseconds time =</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        Chrono::duration_cast&lt;Chrono::milliseconds&gt;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        (SysClock::now() - <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;start_time_);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        shell.<a class="code" href="classSayuri_1_1UCIShell.html#a965826e93468e8c572cdcfed927ef7e9">PrintPVInfo</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_, 0,</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].score(), time,</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_, <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level]);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="comment">// --- Aspiration Windows --- //</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordtype">int</span> delta =</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;aspiration_windows_delta();</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="comment">// 探索窓の設定。</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_aspiration_windows()</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      &amp;&amp; (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_ &gt;= <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      aspiration_windows_limit_depth())) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        beta = alpha + delta;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        alpha -= delta;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        alpha = -<a class="code" href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">MAX_VALUE</a>;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        beta = <a class="code" href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">MAX_VALUE</a>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="comment">// 標準出力に深さ情報を送る。</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      shell.<a class="code" href="classSayuri_1_1UCIShell.html#a4ef8124440db52b30af4f3a3222a606b">PrintDepthInfo</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="comment">// 前回の繰り返しの最善手を得る。</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> prev_best = 0;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_ttable()) {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        table.<a class="code" href="classSayuri_1_1TranspositionTable.html#ab32fdced7f734a081a189f96de0cb2ba">Lock</a>();</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keyword">const</span> <a class="code" href="classSayuri_1_1TTEntry.html">TTEntry</a>&amp; prev_entry =</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a83ac19bead10741ecbb6b0f89c6975b1">GetEntry</a>(pos_hash, <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_ - 1);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keywordflow">if</span> (prev_entry &amp;&amp; (prev_entry.<a class="code" href="classSayuri_1_1TTEntry.html#aaa65f55176f09aedcafbbf4279eb606b">score_type</a>() != <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87">ScoreType::ALPHA</a>)) {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;          prev_best = prev_entry.<a class="code" href="classSayuri_1_1TTEntry.html#a1818c23afb991c0e7d666cd789256c56">best_move</a>();</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Unlock</a>();</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="comment">// --- Check Extension --- //</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordtype">int</span> depth = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordflow">if</span> (is_checked) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        depth += 1;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      <span class="comment">// 仕事を作る。</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      std::mutex mutex;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <a class="code" href="classSayuri_1_1PositionRecord.html">PositionRecord</a> record(*<span class="keyword">this</span>);</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordtype">int</span> num_all_moves = maker.<a class="code" href="classSayuri_1_1MoveMaker.html#a30fa735ffc2c71e492dbc9ab08d41f3f">GenMoves</a>&lt;<a class="code" href="namespaceSayuri.html#a38eace0fcb969cf644905fc3ff641791a5fb1f955b45e38e31789286a1790398d">GenMoveType::ALL</a>&gt;(prev_best,</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;iid_stack_[level],</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][0],</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[level][1]);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34">ScoreType</a> score_type = <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34ac41e056424136b6e8c4e23dd6326efa1">ScoreType::EXACT</a>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordtype">bool</span> has_legal_move = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <a class="code" href="classSayuri_1_1Job.html">Job</a>&amp; job = <a class="code" href="classSayuri_1_1ChessEngine.html#a197c8c14759ad6bc79ba39078287686b">job_table_</a>[level];</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#ab51c5b67b3383c433f81c78f05f2d293">Init</a>(maker);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a> = &amp;mutex;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a558bb7e4ff6ee816782fdddc3c37bc33">record_ptr_</a> = &amp;record;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#ab3eab4889a014d2c5d87a654e300ac15">node_type_</a> = <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4aa565153df227b0510b1c789d5cdc39ec">NodeType::PV</a>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a2667b5609b3ff070c3ddf1e44b8c3c02">pos_hash_</a> = pos_hash;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> = depth;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> = level;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a> = &amp;alpha;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a> = &amp;beta;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">delta_ptr_</a> = &amp;delta;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a> = &amp;table;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a> = &amp;<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level];</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a54db0b050b89681483356f05a9659f6d">is_null_searching_</a> = <a class="code" href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">is_null_searching_</a>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#ad0caeeb84ca86f74568338ad85644555">null_reduction_</a> = 0;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#aec295bc1d2ddb9afbdaed175ed64f0fd">score_type_ptr_</a> = &amp;score_type;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a02f609a81a57ad7473d2f95f0d25475c">material_</a> = material;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a3f0219a378f20611724f9626aece42c0">is_checked_</a> = is_checked;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a61730bd1bbc2dcca36708950aa8b84b5">num_all_moves_</a> = num_all_moves;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#abf7fa1f0f9379ea036b1ae3049f5ae7b">has_legal_move_ptr_</a> = &amp;has_legal_move;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#ae74c358dc27ca27cf13e101e4a132bb6">moves_to_search_ptr_</a> = &amp;moves_to_search;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a70c08dd04c6981497834f79556d7429f">next_print_info_time_ptr_</a> = &amp;next_print_info_time;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="comment">// ヘルプして待つ。</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;helper_queue_ptr_-&gt;HelpRoot(job);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#ab72697ada209d19270bf7dc5f84c79d1">WaitForHelpers</a>();</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="comment">// メイトを見つけたらフラグを立てる。</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <span class="comment">// 直接ループを抜けない理由は、depth等の終了条件対策。</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level].mate_in() &gt;= 0) {</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        found_mate = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">// スレッドをジョイン。</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;helper_queue_ptr_-&gt;ReleaseHelpers();</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; thread : thread_vec_) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span> (thread.joinable()) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        thread.join();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="comment">// 最後に情報を送る。</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    now = SysClock::now();</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    shell.<a class="code" href="classSayuri_1_1UCIShell.html#a2d27e96ff6c81cbf61a8dd82738025c6">PrintOtherInfo</a></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    (Chrono::duration_cast&lt;Chrono::milliseconds&gt;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    (now - (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;start_time_)),</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_, table.<a class="code" href="classSayuri_1_1TranspositionTable.html#a61b2bdb67056b99a2a7cad4c342057ba">GetUsedPermill</a>());</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// 探索終了したけど、まだ思考を止めてはいけない場合、関数を終了しない。</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[level];</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// YBWC探索用スレッド。</span></div>
<div class="line"><a name="l00880"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a3ef155b7de31b9c28593f90f27036603">  880</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a3ef155b7de31b9c28593f90f27036603">ChessEngine::ThreadYBWC</a>(<a class="code" href="classSayuri_1_1UCIShell.html">UCIShell</a>&amp; shell) {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">// 子エンジンを作る。</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#ac71b5f96b280ccc2b507742ba47fea24">mutex_</a>.lock();</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    std::unique_ptr&lt;ChessEngine&gt; child_ptr(<span class="keyword">new</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a72b90003a30d17b3ed7fa9de58def817">ChessEngine</a>());</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    child_ptr-&gt;shared_st_ptr_ = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#ac71b5f96b280ccc2b507742ba47fea24">mutex_</a>.unlock();</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="comment">// 仕事ループ。</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="comment">// 仕事を拾う。</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <a class="code" href="classSayuri_1_1Job.html">Job</a>* job_ptr = child_ptr-&gt;shared_st_ptr_-&gt;helper_queue_ptr_-&gt;GetJob();</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="keywordflow">if</span> (!job_ptr) {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="comment">// 駒の配置を読み込む。</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        child_ptr-&gt;LoadRecord(*(job_ptr-&gt;<a class="code" href="classSayuri_1_1Job.html#a558bb7e4ff6ee816782fdddc3c37bc33">record_ptr_</a>));</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="comment">// Null Move探索中かどうかをセット。</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        child_ptr-&gt;<a class="code" href="classSayuri_1_1Job.html#a54db0b050b89681483356f05a9659f6d">is_null_searching_</a> = job_ptr-&gt;<a class="code" href="classSayuri_1_1Job.html#a54db0b050b89681483356f05a9659f6d">is_null_searching_</a>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">if</span> (job_ptr-&gt;<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> &lt;= 0) {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;          <span class="comment">// ルートノード。</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;          child_ptr-&gt;SearchRootParallel(*job_ptr, shell);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;          <span class="comment">// ルートではないノード。</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;          <span class="keywordflow">if</span> (job_ptr-&gt;<a class="code" href="classSayuri_1_1Job.html#ab3eab4889a014d2c5d87a654e300ac15">node_type_</a> == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4aa565153df227b0510b1c789d5cdc39ec">NodeType::PV</a>) {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            child_ptr-&gt;SearchParallel&lt;<a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4aa565153df227b0510b1c789d5cdc39ec">NodeType::PV</a>&gt;(*job_ptr);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            child_ptr-&gt;SearchParallel&lt;<a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">NodeType::NON_PV</a>&gt;(*job_ptr);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          }</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">// 並列探索。</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keyword">template</span>&lt;NodeType Type&gt;</div>
<div class="line"><a name="l00920"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a3021cae869ef17e025d33660412a0658">  920</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a3021cae869ef17e025d33660412a0658">ChessEngine::SearchParallel</a>(<a class="code" href="classSayuri_1_1Job.html">Job</a>&amp; job) {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="comment">// 仕事ループ。</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> side = <a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> enemy_side = side ^ 0x3;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordtype">int</span> num_moves = 0;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordtype">int</span> margin = <a class="code" href="classSayuri_1_1ChessEngine.html#ab6de10e62ba98e31866ba8fe6d31b083">GetMargin</a>(job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a>);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="comment">// パラメータ保存。</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">// YBWC。</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordtype">int</span> ybwc_after_moves =</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;ybwc_after_moves();</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordtype">int</span> ybwc_limit_depth =</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;ybwc_limit_depth();</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="comment">// History Pruning。</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordtype">bool</span> enable_history_pruning =</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_history_pruning();</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordtype">int</span> history_pruning_limit_depth =</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_limit_depth();</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordtype">int</span> history_pruning_move_threshold = job.<a class="code" href="classSayuri_1_1Job.html#a61730bd1bbc2dcca36708950aa8b84b5">num_all_moves_</a></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    * <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_move_threshold();</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordtype">int</span> history_pruning_after_moves =</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_after_moves();</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    history_pruning_move_threshold =</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    history_pruning_move_threshold &lt; history_pruning_after_moves</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    ? history_pruning_after_moves : history_pruning_move_threshold;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    std::uint64_t history_pruning_threshold = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    * <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_threshold();</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordtype">int</span> history_pruning_reduction =</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;history_pruning_reduction();</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">// Late Move Reduction。</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordtype">bool</span> enable_lmr = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_lmr();</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordtype">int</span> lmr_limit_depth =</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_limit_depth();</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordtype">int</span> lmr_threshold = job.<a class="code" href="classSayuri_1_1Job.html#a61730bd1bbc2dcca36708950aa8b84b5">num_all_moves_</a></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    * <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_threshold();</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordtype">int</span> lmr_after_moves =</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_after_moves();</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    lmr_threshold =</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    lmr_threshold &lt; lmr_after_moves ? lmr_after_moves : lmr_threshold;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordtype">int</span> lmr_search_reduction =</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_search_reduction();</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// Futility Pruning。</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordtype">bool</span> enable_futility_pruning =</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_futility_pruning();</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="keywordtype">int</span> futility_pruning_depth =</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;futility_pruning_depth();</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> move = job.<a class="code" href="classSayuri_1_1Job.html#ac10d16aa84991f440f8a2837e5831f87">PickMove</a>(); move; move = job.<a class="code" href="classSayuri_1_1Job.html#ac10d16aa84991f440f8a2837e5831f87">PickMove</a>()) {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="comment">// すでにベータカットされていれば仕事をしない。</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <span class="keywordflow">if</span> (*(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>) &gt;= *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>)) {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="comment">// 別スレッドに助けを求める。(YBWC)</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="keywordflow">if</span> ((job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> &gt;= ybwc_limit_depth) &amp;&amp; (num_moves &gt; ybwc_after_moves)) {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;helper_queue_ptr_-&gt;Help(job);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="comment">// 次のハッシュ。</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> next_hash = <a class="code" href="classSayuri_1_1ChessEngine.html#a7e8b4b7a7a3520176b025bc6776ad9b3">GetNextHash</a>(job.<a class="code" href="classSayuri_1_1Job.html#a2667b5609b3ff070c3ddf1e44b8c3c02">pos_hash_</a>, move);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="comment">// 次の局面のマテリアルを得る。</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      <span class="keywordtype">int</span> next_my_material = <a class="code" href="classSayuri_1_1ChessEngine.html#a2f5a30e39ceb33d59e7258e55b1b87a8">GetNextMyMaterial</a>(job.<a class="code" href="classSayuri_1_1Job.html#a02f609a81a57ad7473d2f95f0d25475c">material_</a>, move);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">MakeMove</a>(move);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="comment">// 合法手じゃなければ次の手へ。</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side)) {</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      num_moves = job.<a class="code" href="classSayuri_1_1Job.html#a42dbbaccf84063521f4820bbe1b1e990">Count</a>();</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <span class="comment">// 合法手が見つかったのでフラグを立てる。</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      *(job.<a class="code" href="classSayuri_1_1Job.html#abf7fa1f0f9379ea036b1ae3049f5ae7b">has_legal_move_ptr_</a>) = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <span class="comment">// --- Futility Pruning --- //</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="keywordflow">if</span> (enable_futility_pruning) {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">if</span> (job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> &lt;= futility_pruning_depth) {</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          <span class="keywordflow">if</span> ((next_my_material + margin) &lt;= *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>)) {</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;          }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="comment">// 手の情報を得る。</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> from = <a class="code" href="namespaceSayuri.html#ad9efed3eea6135b5ec505e10a92c9613">move_from</a>(move);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> to = <a class="code" href="namespaceSayuri.html#ab8e43a53c8ed41163b8855c6f68b0793">move_to</a>(move);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">// 探索。</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordtype">int</span> score = 0;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keywordtype">int</span> temp_alpha = *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keywordtype">int</span> temp_beta = *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>);</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordtype">int</span> new_depth = job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a>;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="comment">// History PruningとLate Move Reductionの共通条件。</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordtype">bool</span> is_hp_or_lmr_ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordflow">if</span> (!(job.<a class="code" href="classSayuri_1_1Job.html#a3f0219a378f20611724f9626aece42c0">is_checked_</a>) &amp;&amp; !(job.<a class="code" href="classSayuri_1_1Job.html#ad0caeeb84ca86f74568338ad85644555">null_reduction_</a>)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      &amp;&amp; !(move &amp; (<a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a> | <a class="code" href="namespaceSayuri.html#a6069d68a000c2a664d6530acbe419e88">PROMOTION_MASK</a>))</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      &amp;&amp; !<a class="code" href="namespaceSayuri.html#ac2075b4a679c5046b4581194d3c41d77">EqualMove</a>(move, <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a>][0])</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      &amp;&amp; !<a class="code" href="namespaceSayuri.html#ac2075b4a679c5046b4581194d3c41d77">EqualMove</a>(move, <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a>][1])) {</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        is_hp_or_lmr_ok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="comment">// --- History Pruning --- //</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="keywordflow">if</span> (Type == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">NodeType::NON_PV</a>) {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keywordflow">if</span> (enable_history_pruning) {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;          <span class="keywordflow">if</span> (is_hp_or_lmr_ok &amp;&amp; (new_depth &gt;= history_pruning_limit_depth)</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;          &amp;&amp; (num_moves &gt; history_pruning_move_threshold)</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;          &amp;&amp; (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to]</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;          &lt; history_pruning_threshold)) {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            new_depth -= history_pruning_reduction;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;          }</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        }</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="comment">// --- Late Move Reduction --- //</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="keywordflow">if</span> (enable_lmr) {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">if</span> (is_hp_or_lmr_ok &amp;&amp; (new_depth &gt;= lmr_limit_depth)</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        &amp;&amp; (num_moves &gt; lmr_threshold)) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;          score = -Search&lt;NodeType::NON_PV&gt;(next_hash,</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;          new_depth - lmr_search_reduction - 1, job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1,</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;          -(temp_alpha + 1), -temp_alpha, -next_my_material,</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;          <span class="comment">// PVSearchをするためにtemp_alphaより大きくしておく。</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;          score = temp_alpha + 1;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="comment">// PVSearchをするためにtemp_alphaより大きくしておく。</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        score = temp_alpha + 1;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      }</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <span class="keywordflow">if</span> (score &gt; temp_alpha) {</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="comment">// --- PVSearch --- //</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <span class="keywordflow">if</span> ((num_moves &lt;= 1) || (Type == <a class="code" href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">NodeType::NON_PV</a>)) {</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;          <span class="comment">// フルウィンドウ探索。</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;          score = -Search&lt;Type&gt;(next_hash, new_depth - 1,</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1, -temp_beta, -temp_alpha, -next_my_material,</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;          *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;          <span class="comment">// PV発見後。</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;          <span class="comment">// ゼロウィンドウ探索。</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;          score = -Search&lt;NodeType::NON_PV&gt;(next_hash, new_depth - 1,</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1, -(temp_alpha + 1), -temp_alpha,</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          -next_my_material, *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;          <span class="keywordflow">if</span> (score &gt; temp_alpha) {</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <span class="comment">// fail lowならず。</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            score = -Search&lt;NodeType::PV&gt;(next_hash, new_depth - 1,</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1, -temp_beta, -temp_alpha, -next_my_material,</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;          }</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      }</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <span class="comment">// 同じ局面の繰り返しは0点。</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="keywordflow">if</span> (job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> &lt;= 1) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="classSayuri_1_1ChessEngine.html#a5ecb413f5ccfb0e8b80a7385e90e5e44">position</a> : <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;position_history_) {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a5ecb413f5ccfb0e8b80a7385e90e5e44">position</a> == *<span class="keyword">this</span>) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            score = <a class="code" href="namespaceSayuri.html#a603f7001236671f9f6552d6e78719033">SCORE_DRAW</a>;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;          }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;lock();  <span class="comment">// ロック。</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="comment">// 探索した深さを更新。</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a> &gt; job.<a class="code" href="classSayuri_1_1Job.html#ab02c76a312e63b1b35775544032b4541">client_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a>) {</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        job.<a class="code" href="classSayuri_1_1Job.html#ab02c76a312e63b1b35775544032b4541">client_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a> = <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a>;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="comment">// アルファ値を更新。</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="keywordflow">if</span> (score &gt; *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>)) {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="comment">// 評価値のタイプをセット。</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordflow">if</span> (*(job.<a class="code" href="classSayuri_1_1Job.html#aec295bc1d2ddb9afbdaed175ed64f0fd">score_type_ptr_</a>) == <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87">ScoreType::ALPHA</a>) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;          *(job.<a class="code" href="classSayuri_1_1Job.html#aec295bc1d2ddb9afbdaed175ed64f0fd">score_type_ptr_</a>) = <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34ac41e056424136b6e8c4e23dd6326efa1">ScoreType::EXACT</a>;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        <span class="comment">// PVラインをセット。</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1PVLine.html#a5f8fb92774ac457ce6c1ec53e684ac2e">SetMove</a>(move);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1PVLine.html#a73d701101df6fc02b7c6267ad9aa43ed">Insert</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1]);</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>) = score;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      }</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <span class="comment">// ベータ値を調べる。</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      <span class="keywordflow">if</span> (score &gt;= *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>)) {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="comment">// 評価値の種類をセット。</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        *(job.<a class="code" href="classSayuri_1_1Job.html#aec295bc1d2ddb9afbdaed175ed64f0fd">score_type_ptr_</a>) = <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a36b84f8e3fba5bf993e3ba352d62d146">ScoreType::BETA</a>;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="comment">// 取らない手。</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        <span class="keywordflow">if</span> (!(move &amp; <a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a>)) {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;          <span class="comment">// キラームーブ。</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer()) {</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a>][0] = move;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_killer_2()) {</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;killer_stack_[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 2][1] = move;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;          }</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          <span class="comment">// ヒストリー。</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_history()) {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to] +=</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> * job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a>;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to]</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            &gt; <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_) {</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_max_ =</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;              <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;history_[side][from][to];</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;          }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="comment">// ベータカット。</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>) = *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="comment">// 仕事終了。</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#af4fe5ed6ef3bc4e62c26c03d20febef6">FinishMyJob</a>();</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">// 実体化。</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keyword">template</span> <span class="keywordtype">void</span> ChessEngine::SearchParallel&lt;NodeType::PV&gt;(<a class="code" href="classSayuri_1_1Job.html">Job</a>&amp; job);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keyword">template</span> <span class="keywordtype">void</span> ChessEngine::SearchParallel&lt;NodeType::NON_PV&gt;(<a class="code" href="classSayuri_1_1Job.html">Job</a>&amp; job);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="comment">// ルートノードで呼び出される、別スレッド用探索関数。</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a7301a2506b3ff852c3f1d56ffdfb06fa"> 1166</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a7301a2506b3ff852c3f1d56ffdfb06fa">ChessEngine::SearchRootParallel</a>(<a class="code" href="classSayuri_1_1Job.html">Job</a>&amp; job, <a class="code" href="classSayuri_1_1UCIShell.html">UCIShell</a>&amp; shell) {</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="comment">// 仕事ループ。</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> side = <a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> enemy_side = side ^ 0x3;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordtype">int</span> num_moves = 0;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">// パラメータを保存。</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="comment">// YBWC。</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordtype">int</span> ybwc_after_moves =</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;ybwc_after_moves();</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keywordtype">int</span> ybwc_limit_depth =</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;ybwc_limit_depth();</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="comment">// Late Move Reduction。</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordtype">bool</span> enable_lmr = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_lmr();</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordtype">int</span> lmr_limit_depth =</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_limit_depth();</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordtype">int</span> lmr_threshold = job.<a class="code" href="classSayuri_1_1Job.html#a61730bd1bbc2dcca36708950aa8b84b5">num_all_moves_</a></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    * <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_threshold();</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordtype">int</span> lmr_after_moves =</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_after_moves();</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    lmr_threshold =</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    lmr_threshold &lt; lmr_after_moves ? lmr_after_moves : lmr_threshold;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="keywordtype">int</span> lmr_search_reduction =</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;lmr_search_reduction();</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> move = job.<a class="code" href="classSayuri_1_1Job.html#ac10d16aa84991f440f8a2837e5831f87">PickMove</a>(); move; move = job.<a class="code" href="classSayuri_1_1Job.html#ac10d16aa84991f440f8a2837e5831f87">PickMove</a>()) {</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="comment">// 定時(1秒)報告の情報を送る。</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;lock();  <span class="comment">// ロック。</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <a class="code" href="namespaceSayuri.html#a08729a5deca223e833840c8b8e224b23">TimePoint</a> now = SysClock::now();</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordflow">if</span> (now &gt; *(job.<a class="code" href="classSayuri_1_1Job.html#a70c08dd04c6981497834f79556d7429f">next_print_info_time_ptr_</a>)) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        shell.<a class="code" href="classSayuri_1_1UCIShell.html#a2d27e96ff6c81cbf61a8dd82738025c6">PrintOtherInfo</a>(Chrono::duration_cast&lt;Chrono::milliseconds&gt;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        (now - <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;start_time_),</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_, job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1TranspositionTable.html#a61b2bdb67056b99a2a7cad4c342057ba">GetUsedPermill</a>());</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        *(job.<a class="code" href="classSayuri_1_1Job.html#a70c08dd04c6981497834f79556d7429f">next_print_info_time_ptr_</a>) = now + Chrono::milliseconds(1000);</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="comment">// 探索すべき手が指定されていれば、今の手がその手かどうか調べる。</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">if</span> (!(job.<a class="code" href="classSayuri_1_1Job.html#ae74c358dc27ca27cf13e101e4a132bb6">moves_to_search_ptr_</a>-&gt;empty())) {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="keywordtype">bool</span> hit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keyword">const</span> std::vector&lt;Move&gt;&amp; vec = *(job.<a class="code" href="classSayuri_1_1Job.html#ae74c358dc27ca27cf13e101e4a132bb6">moves_to_search_ptr_</a>);</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> move_2 : vec) {</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespaceSayuri.html#ac2075b4a679c5046b4581194d3c41d77">EqualMove</a>(move_2, move)) {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            <span class="comment">// 探索すべき手だった。</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            hit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          }</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">if</span> (!hit) {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          <span class="comment">// 探索すべき手ではなかった。</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;          <span class="comment">// 次の手へ。</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      }</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="comment">// 別スレッドに助けを求める。(YBWC)</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="keywordflow">if</span> ((job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> &gt;= ybwc_limit_depth) &amp;&amp; (num_moves &gt; ybwc_after_moves)) {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;helper_queue_ptr_-&gt;Help(job);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      }</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <span class="comment">// 探索したレベルをリセット。</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a> = 0;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      <span class="comment">// 次のハッシュ。</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <a class="code" href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Hash</a> next_hash = <a class="code" href="classSayuri_1_1ChessEngine.html#a7e8b4b7a7a3520176b025bc6776ad9b3">GetNextHash</a>(job.<a class="code" href="classSayuri_1_1Job.html#a2667b5609b3ff070c3ddf1e44b8c3c02">pos_hash_</a>, move);</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="comment">// 次の局面のマテリアル。</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <span class="keywordtype">int</span> next_my_material = <a class="code" href="classSayuri_1_1ChessEngine.html#a2f5a30e39ceb33d59e7258e55b1b87a8">GetNextMyMaterial</a>(job.<a class="code" href="classSayuri_1_1Job.html#a02f609a81a57ad7473d2f95f0d25475c">material_</a>, move);</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">MakeMove</a>(move);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="comment">// 合法手じゃなければ次の手へ。</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], enemy_side)) {</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      num_moves = job.<a class="code" href="classSayuri_1_1Job.html#a42dbbaccf84063521f4820bbe1b1e990">Count</a>();</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      <span class="comment">// 現在探索している手の情報を表示。</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;lock();  <span class="comment">// ロック。</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      shell.<a class="code" href="classSayuri_1_1UCIShell.html#a52ecca84266ade437a87e3e0eed51367">PrintCurrentMoveInfo</a>(move, num_moves);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <span class="comment">// --- PVSearch --- //</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <span class="keywordtype">int</span> score = 0;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="keywordtype">int</span> temp_alpha = *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <span class="keywordtype">int</span> temp_beta = *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="keywordflow">if</span> (num_moves &lt;= 1) {</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;          <span class="comment">// 探索終了。</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;          <span class="comment">// フルでPVを探索。</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;          score = -Search&lt;NodeType::PV&gt; (next_hash, job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> - 1,</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1, -temp_beta, -temp_alpha, -next_my_material,</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;          *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;          <span class="comment">// アルファ値、ベータ値を調べる。</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;lock();  <span class="comment">// ロック。</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;          <span class="keywordflow">if</span> (score &gt;= temp_beta) {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            <span class="comment">// 探索失敗。</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            <span class="comment">// ベータ値を広げる。</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1].mate_in() &gt;= 0)</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;            &amp;&amp; ((<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1].mate_in() % 2) == 1)) {</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;              <span class="comment">// メイトっぽかった場合。</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;              *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>) = <a class="code" href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">MAX_VALUE</a>;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;              *(job.<a class="code" href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">delta_ptr_</a>) *= 2;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;              *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>) += *(job.<a class="code" href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">delta_ptr_</a>);</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            }</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            temp_beta = *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>);</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (score &lt;= temp_alpha) {</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            <span class="comment">// 探索失敗。</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            <span class="comment">// アルファ値を広げる。</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1].mate_in() &gt;= 0)</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            &amp;&amp; ((<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1].mate_in() % 2) == 0)) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;              <span class="comment">// メイトされていたかもしれない場合。</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;              *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>) = -<a class="code" href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">MAX_VALUE</a>;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;              *(job.<a class="code" href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">delta_ptr_</a>) *= 2;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;              *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>) -= *(job.<a class="code" href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">delta_ptr_</a>);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            temp_alpha = *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;          }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        }</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="comment">// --- Late Move Reduction --- //</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keywordflow">if</span> (enable_lmr) {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;          <span class="keywordflow">if</span> (!(job.<a class="code" href="classSayuri_1_1Job.html#a3f0219a378f20611724f9626aece42c0">is_checked_</a>)</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;          &amp;&amp; (job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> &gt;= lmr_limit_depth)</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;          &amp;&amp; (num_moves &gt; lmr_threshold)</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;          &amp;&amp; !(move &amp; (<a class="code" href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">CAPTURED_PIECE_MASK</a> | <a class="code" href="namespaceSayuri.html#a6069d68a000c2a664d6530acbe419e88">PROMOTION_MASK</a>))) {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            <span class="comment">// ゼロウィンドウ探索。</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            score = -Search&lt;NodeType::NON_PV&gt;(next_hash,</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> - lmr_search_reduction - 1, job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1,</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            -(temp_alpha + 1), -temp_alpha, -next_my_material,</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            <span class="comment">// 普通に探索するためにscoreをalphaより大きくしておく。</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            score = temp_alpha + 1;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;          }</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;          <span class="comment">// 普通に探索するためにscoreをalphaより大きくしておく。</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;          score = temp_alpha + 1;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="comment">// 普通の探索。</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keywordflow">if</span> (score &gt; temp_alpha) {</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;          <span class="comment">// ゼロウィンドウ探索。</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;          score = -Search&lt;NodeType::NON_PV&gt;(next_hash, job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> - 1,</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1, -(temp_alpha + 1), -temp_alpha,</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          -next_my_material, *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;          <span class="keywordflow">if</span> (score &gt; temp_alpha) {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;              <span class="comment">// 探索終了。</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;              <span class="comment">// フルウィンドウで再探索。</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;              score = -Search&lt;NodeType::PV&gt;(next_hash, job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a> - 1,</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;              job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1, -temp_beta, -temp_alpha, -next_my_material,</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;              *(job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>));</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;              <span class="comment">// ベータ値を調べる。</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;              job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;lock();  <span class="comment">// ロック。</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;              <span class="keywordflow">if</span> (score &gt;= temp_beta) {</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                <span class="comment">// 探索失敗。</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                <span class="comment">// ベータ値を広げる。</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                <span class="keywordflow">if</span> ((<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1].mate_in() &gt;= 0)</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                &amp;&amp; ((<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1].mate_in() % 2) == 1)) {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                  <span class="comment">// メイトっぽかった場合。</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                  *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>) = <a class="code" href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">MAX_VALUE</a>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                  job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                  *(job.<a class="code" href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">delta_ptr_</a>) *= 2;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                  *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>) += *(job.<a class="code" href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">delta_ptr_</a>);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                }</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                temp_beta = *(job.<a class="code" href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">beta_ptr_</a>);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;              } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;              }</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;              job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;          }</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      }</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      <span class="comment">// 同じ局面の繰り返しは0点。</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="classSayuri_1_1ChessEngine.html#a5ecb413f5ccfb0e8b80a7385e90e5e44">position</a> : <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;position_history_) {</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a5ecb413f5ccfb0e8b80a7385e90e5e44">position</a> == *<span class="keyword">this</span>) {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;          score = <a class="code" href="namespaceSayuri.html#a603f7001236671f9f6552d6e78719033">SCORE_DRAW</a>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        }</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      }</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">UnmakeMove</a>(move);</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <span class="comment">// ストップがかかっていたらループを抜ける。</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ShouldBeStopped</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <span class="comment">// 最善手を見つけた。</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;lock();  <span class="comment">// ロック。</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <span class="keywordflow">if</span> (score &gt; *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>)) {</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        <span class="comment">// PVラインにセット。</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1PVLine.html#a5f8fb92774ac457ce6c1ec53e684ac2e">SetMove</a>(move);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1PVLine.html#a73d701101df6fc02b7c6267ad9aa43ed">Insert</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">pv_line_table_</a>[job.<a class="code" href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">level_</a> + 1]);</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1PVLine.html#a21e1df968bb412490923bcbe147614a4">score</a>(score);</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <span class="comment">// トランスポジションテーブルに登録。</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_ttable()) {</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">table_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1TranspositionTable.html#a7be71ee1c0ac1896e45f14abb91f1757">Add</a>(job.<a class="code" href="classSayuri_1_1Job.html#a2667b5609b3ff070c3ddf1e44b8c3c02">pos_hash_</a>, job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a>, score,</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          <a class="code" href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34ac41e056424136b6e8c4e23dd6326efa1">ScoreType::EXACT</a>, (*(job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>))[0],</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;          job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>-&gt;<a class="code" href="classSayuri_1_1PVLine.html#ab65a4294ffd418442ca321c9b297a19a">mate_in</a>());</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        }</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <span class="comment">// 標準出力にPV情報を表示。</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        now = SysClock::now();</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        Chrono::milliseconds time =</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        Chrono::duration_cast&lt;Chrono::milliseconds&gt;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        (now - <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;start_time_);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        shell.<a class="code" href="classSayuri_1_1UCIShell.html#a965826e93468e8c572cdcfed927ef7e9">PrintPVInfo</a>(job.<a class="code" href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">depth_</a>, <a class="code" href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">searched_level_</a>, score,</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        time, <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_, *(job.<a class="code" href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">pv_line_ptr_</a>));</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        *(job.<a class="code" href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">alpha_ptr_</a>) = score;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      }</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      job.<a class="code" href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">mutex_ptr_</a>-&gt;unlock();  <span class="comment">// ロック解除。</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    }</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="comment">// 仕事終了。</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    job.<a class="code" href="classSayuri_1_1Job.html#af4fe5ed6ef3bc4e62c26c03d20febef6">FinishMyJob</a>();</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  }</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="comment">// SEEで候補手を評価する。</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a93b267327aa045c518c8aa77ae2dd666"> 1419</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a93b267327aa045c518c8aa77ae2dd666">ChessEngine::SEE</a>(<a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> move)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordtype">int</span> score = 0;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;enable_see())) <span class="keywordflow">return</span> score;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="keywordflow">if</span> (move) {</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <span class="comment">// 手の情報を得る。</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> to = <a class="code" href="namespaceSayuri.html#ab8e43a53c8ed41163b8855c6f68b0793">move_to</a>(move);</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <a class="code" href="namespaceSayuri.html#a82185f3c7274880aa4b64d173d84f8e2">MoveType</a> move_type = <a class="code" href="namespaceSayuri.html#a0d5c1ca1621ae1a3c39994a4e007ee4b">move_move_type</a>(move);</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="comment">// キングを取る手なら無視。</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#adbe8c289181aab677aa9fdbd7373db9b">piece_board_</a>[to] == <a class="code" href="namespaceSayuri.html#a11d6a949bb78467349956ec7b5bbe331">KING</a>) {</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordflow">return</span> score;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      }</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="comment">// 取る駒の価値を得る。</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="keywordtype">int</span> capture_value = 0;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keywordflow">if</span> (move_type == <a class="code" href="namespaceSayuri.html#abca6f74209e98e45f842b5d13a4f5ff4">EN_PASSANT</a>) {</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="comment">// アンパッサン。</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        capture_value = <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;material()[<a class="code" href="namespaceSayuri.html#a45dbc6ce3a8aad524995ca8a2ace1474">PAWN</a>];</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        capture_value =</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;material()[<a class="code" href="classSayuri_1_1ChessEngine.html#adbe8c289181aab677aa9fdbd7373db9b">piece_board_</a>[to]];</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      }</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      <span class="comment">// ポーンの昇格。</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      <span class="keywordflow">if</span> ((move &amp; <a class="code" href="namespaceSayuri.html#a6069d68a000c2a664d6530acbe419e88">PROMOTION_MASK</a>)) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        capture_value +=</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;material()[<a class="code" href="namespaceSayuri.html#af32a3e9ca4a7224599e147c9b4a04ec8">move_promotion</a>(move)]</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        - <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;material()[<a class="code" href="namespaceSayuri.html#a45dbc6ce3a8aad524995ca8a2ace1474">PAWN</a>];</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      }</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      <a class="code" href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Side</a> side = <a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html">ChessEngine</a>* <span class="keyword">self</span> = <span class="keyword">const_cast&lt;</span><a class="code" href="classSayuri_1_1ChessEngine.html">ChessEngine</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      <span class="keyword">self</span>-&gt;<a class="code" href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">MakeMove</a>(move);</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="comment">// 違法な手なら計算しない。</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <span class="keywordflow">if</span> (!(<a class="code" href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">IsAttacked</a>(<a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[side], side ^ 0x3))) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="comment">// 再帰して次の局面の評価値を得る。</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        score = capture_value - <span class="keyword">self</span>-&gt;SEE(<a class="code" href="classSayuri_1_1ChessEngine.html#a8ed26f51d27391d76bccbfb0d8dfdb61">GetNextSEEMove</a>(to));</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="keyword">self</span>-&gt;UnmakeMove(move);</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    }</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">return</span> score;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  }</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="comment">// SEE()で使う、次の手を得る。</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a8ed26f51d27391d76bccbfb0d8dfdb61"> 1468</a></span>&#160;  <a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> <a class="code" href="classSayuri_1_1ChessEngine.html#a8ed26f51d27391d76bccbfb0d8dfdb61">ChessEngine::GetNextSEEMove</a>(<a class="code" href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Square</a> target)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="comment">// キングがターゲットの時はなし。</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    <span class="keywordflow">if</span> (target == <a class="code" href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">king_</a>[<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a> ^ 0x3]) {</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="comment">// 価値の低いものから調べる。</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespaceSayuri.html#ab844f2804d919a8d48bd02681f1689c5">Piece</a> piece_type = <a class="code" href="namespaceSayuri.html#a45dbc6ce3a8aad524995ca8a2ace1474">PAWN</a>; piece_type &lt;= <a class="code" href="namespaceSayuri.html#a11d6a949bb78467349956ec7b5bbe331">KING</a>; piece_type++) {</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <a class="code" href="namespaceSayuri.html#a8ec202eb4942f1adbcfb778141bd9b1a">Bitboard</a> attackers = 0;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <a class="code" href="namespaceSayuri.html#ab844f2804d919a8d48bd02681f1689c5">Piece</a> promotion = <a class="code" href="namespaceSayuri.html#a3d6d21eb62cdffd512fe4ccddd8511ec">EMPTY</a>;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="keywordflow">switch</span> (piece_type) {</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceSayuri.html#a45dbc6ce3a8aad524995ca8a2ace1474">PAWN</a>:</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;          attackers = <a class="code" href="classSayuri_1_1Util.html#ab7bc805b9706d690276f4d810c6d9b5f">Util::GetPawnAttack</a>(target, <a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a> ^ 0x3)</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;          &amp; <a class="code" href="classSayuri_1_1ChessEngine.html#ac6c09f71eb8d8e9a6261f39b99b3b6be">position_</a>[<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>][<a class="code" href="namespaceSayuri.html#a45dbc6ce3a8aad524995ca8a2ace1474">PAWN</a>];</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;          <span class="keywordflow">if</span> (((<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a> == <a class="code" href="namespaceSayuri.html#a3b2f12d45f816ec5a5d1f0a9aa44570e">WHITE</a>) &amp;&amp; (<a class="code" href="classSayuri_1_1Util.html#ade7408eae688017dea24d2291fc285f6">Util::GetRank</a>(target) == <a class="code" href="namespaceSayuri.html#ab895b6486924e4bc7a12714b3a55786c">RANK_8</a>))</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;          || ((<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a> == <a class="code" href="namespaceSayuri.html#a97973d74d3f0792202bde8d652a41f76">BLACK</a>) &amp;&amp; (<a class="code" href="classSayuri_1_1Util.html#ade7408eae688017dea24d2291fc285f6">Util::GetRank</a>(target) == <a class="code" href="namespaceSayuri.html#a7fb3c6a8d6003ecb91db6d812c47ff9e">RANK_1</a>))) {</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            promotion = <a class="code" href="namespaceSayuri.html#a4cdc371480d87aa631fec2bf1318d696">QUEEN</a>;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;          }</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceSayuri.html#aff352a02a00ad3809b178628ef75c31f">KNIGHT</a>:</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;          attackers =</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;          <a class="code" href="classSayuri_1_1Util.html#a46668b0916f51f6a72bd0e93a9b7652c">Util::GetKnightMove</a>(target) &amp; <a class="code" href="classSayuri_1_1ChessEngine.html#ac6c09f71eb8d8e9a6261f39b99b3b6be">position_</a>[<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>][<a class="code" href="namespaceSayuri.html#aff352a02a00ad3809b178628ef75c31f">KNIGHT</a>];</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceSayuri.html#a7140e875d12a2c14b7648bd85978fa03">BISHOP</a>:</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;          attackers = <a class="code" href="classSayuri_1_1ChessEngine.html#a43dc618c4fb77d328fbff1d4f6c0d76e">GetBishopAttack</a>(target) &amp; <a class="code" href="classSayuri_1_1ChessEngine.html#ac6c09f71eb8d8e9a6261f39b99b3b6be">position_</a>[<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>][<a class="code" href="namespaceSayuri.html#a7140e875d12a2c14b7648bd85978fa03">BISHOP</a>];</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceSayuri.html#afd013b6c13e71dfdc857f0f0576e42bc">ROOK</a>:</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;          attackers = <a class="code" href="classSayuri_1_1ChessEngine.html#abacab5219a53c6595be0881aa93c72fa">GetRookAttack</a>(target) &amp; <a class="code" href="classSayuri_1_1ChessEngine.html#ac6c09f71eb8d8e9a6261f39b99b3b6be">position_</a>[<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>][<a class="code" href="namespaceSayuri.html#afd013b6c13e71dfdc857f0f0576e42bc">ROOK</a>];</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceSayuri.html#a4cdc371480d87aa631fec2bf1318d696">QUEEN</a>:</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;          attackers = <a class="code" href="classSayuri_1_1ChessEngine.html#a523747ee3b5ff5e302886496216e7083">GetQueenAttack</a>(target) &amp; <a class="code" href="classSayuri_1_1ChessEngine.html#ac6c09f71eb8d8e9a6261f39b99b3b6be">position_</a>[<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>][<a class="code" href="namespaceSayuri.html#a4cdc371480d87aa631fec2bf1318d696">QUEEN</a>];</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespaceSayuri.html#a11d6a949bb78467349956ec7b5bbe331">KING</a>:</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;          attackers = <a class="code" href="classSayuri_1_1Util.html#afe441f23abf8ab5a1fb336c5ee75c77b">Util::GetKingMove</a>(target) &amp; <a class="code" href="classSayuri_1_1ChessEngine.html#ac6c09f71eb8d8e9a6261f39b99b3b6be">position_</a>[<a class="code" href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">to_move_</a>][<a class="code" href="namespaceSayuri.html#a11d6a949bb78467349956ec7b5bbe331">KING</a>];</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;          <span class="keywordflow">throw</span> <a class="code" href="classSayuri_1_1SayuriError.html">SayuriError</a>(<span class="stringliteral">&quot;駒の種類が不正です。&quot;</span>);</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      }</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <span class="keywordflow">if</span> (attackers) {</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <a class="code" href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Move</a> move = 0;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        <a class="code" href="namespaceSayuri.html#ad9efed3eea6135b5ec505e10a92c9613">move_from</a>(move, <a class="code" href="classSayuri_1_1Util.html#a7da08b551ae4fd7598a801bfdf37cd0f">Util::GetSquare</a>(attackers));</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        <a class="code" href="namespaceSayuri.html#ab8e43a53c8ed41163b8855c6f68b0793">move_to</a>(move, target);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        <a class="code" href="namespaceSayuri.html#af32a3e9ca4a7224599e147c9b4a04ec8">move_promotion</a>(move, promotion);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <a class="code" href="namespaceSayuri.html#a0d5c1ca1621ae1a3c39994a4e007ee4b">move_move_type</a>(move, <a class="code" href="namespaceSayuri.html#af37f7852296b0d09d0c847b0c5e5a05c">NORMAL</a>);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <span class="keywordflow">return</span> move;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      }</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    }</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  }</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <span class="comment">// Futility Pruningのマージンを計算する。</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#ab6de10e62ba98e31866ba8fe6d31b083"> 1520</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classSayuri_1_1ChessEngine.html#ab6de10e62ba98e31866ba8fe6d31b083">ChessEngine::GetMargin</a>(<span class="keywordtype">int</span> depth) {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keywordflow">if</span> (depth &lt;= 1) {</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;futility_pruning_margin();</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    }</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;search_params_ptr_-&gt;futility_pruning_margin()</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    * depth;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  }</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="comment">// 探索のストップ条件を設定する。</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a8493ca6e093608182201017c799270d2"> 1530</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a8493ca6e093608182201017c799270d2">ChessEngine::SetStopper</a>(std::uint32_t max_depth,</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  std::uint64_t max_nodes, Chrono::milliseconds thinking_time,</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keywordtype">bool</span> infinite_thinking) {</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;max_depth_ = max_depth &lt;= <a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a> ? max_depth : <a class="code" href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">MAX_PLYS</a>;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;max_nodes_ =</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    max_nodes &lt;= <a class="code" href="namespaceSayuri.html#a3808419d4bf7336bc3071533f502f0e0">MAX_NODES</a> ? max_nodes : <a class="code" href="namespaceSayuri.html#a3808419d4bf7336bc3071533f502f0e0">MAX_NODES</a>;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;thinking_time_ = thinking_time;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;infinite_thinking_ = infinite_thinking;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="comment">// 無限に思考するかどうかのフラグをセットする。</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a8b31b097bc09387ec19a2603146beedb"> 1541</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a8b31b097bc09387ec19a2603146beedb">ChessEngine::EnableInfiniteThinking</a>(<span class="keywordtype">bool</span> enable) {</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;infinite_thinking_ = enable;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="comment">// 探索を中断しなければいけないかどうかを判断する。</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"><a class="line" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e"> 1546</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">ChessEngine::ShouldBeStopped</a>() {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <span class="comment">// 最低1手は考える。</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_ &lt;= 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;stop_now_) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;infinite_thinking_) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;i_depth_ &gt; <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;max_depth_) {</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;stop_now_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    }</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;num_searched_nodes_ &gt;= <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;max_nodes_) {</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;stop_now_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    }</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <a class="code" href="namespaceSayuri.html#a08729a5deca223e833840c8b8e224b23">TimePoint</a> now = SysClock::now();</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="keywordflow">if</span> ((now - (<a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;start_time_))</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    &gt;= <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;thinking_time_) {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <a class="code" href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">shared_st_ptr_</a>-&gt;stop_now_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;}  <span class="comment">// namespace Sayuri</span></div>
<div class="ttc" id="classSayuri_1_1HelperQueue_html"><div class="ttname"><a href="classSayuri_1_1HelperQueue.html">Sayuri::HelperQueue</a></div><div class="ttdoc">並列探索のスレッドのキューのクラス。 </div><div class="ttdef"><b>Definition:</b> <a href="helper__queue_8h_source.html#l00044">helper_queue.h:44</a></div></div>
<div class="ttc" id="namespaceSayuri_html_aca327c11f21cc528b8b47177be1f1160"><div class="ttname"><a href="namespaceSayuri.html#aca327c11f21cc528b8b47177be1f1160">Sayuri::MAX_VALUE</a></div><div class="ttdeci">constexpr int MAX_VALUE</div><div class="ttdoc">とても大きな数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00290">chess_def.h:290</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a3ef155b7de31b9c28593f90f27036603"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a3ef155b7de31b9c28593f90f27036603">Sayuri::ChessEngine::ThreadYBWC</a></div><div class="ttdeci">void ThreadYBWC(UCIShell &amp;shell)</div><div class="ttdoc">YBWC探索用スレッド。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l00880">chess_engine_search.cpp:880</a></div></div>
<div class="ttc" id="classSayuri_1_1TranspositionTable_html_ab32fdced7f734a081a189f96de0cb2ba"><div class="ttname"><a href="classSayuri_1_1TranspositionTable.html#ab32fdced7f734a081a189f96de0cb2ba">Sayuri::TranspositionTable::Lock</a></div><div class="ttdeci">void Lock()</div><div class="ttdoc">トランスポジションテーブルのロックでロックする。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00232">transposition_table.h:232</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a8ed26f51d27391d76bccbfb0d8dfdb61"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a8ed26f51d27391d76bccbfb0d8dfdb61">Sayuri::ChessEngine::GetNextSEEMove</a></div><div class="ttdeci">Move GetNextSEEMove(Square target) const </div><div class="ttdoc">SEE()で使う、次の手を得る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l01468">chess_engine_search.cpp:1468</a></div></div>
<div class="ttc" id="classSayuri_1_1MoveMaker_html_a30fa735ffc2c71e492dbc9ab08d41f3f"><div class="ttname"><a href="classSayuri_1_1MoveMaker.html#a30fa735ffc2c71e492dbc9ab08d41f3f">Sayuri::MoveMaker::GenMoves</a></div><div class="ttdeci">int GenMoves(Move prev_best, Move iid_move, Move killer_1, Move killer_2)</div><div class="ttdoc">スタックに候補手を生成する。 自らチェックされる手も作る。 </div><div class="ttdef"><b>Definition:</b> <a href="move__maker_8cpp_source.html#l00104">move_maker.cpp:104</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a7fb3c6a8d6003ecb91db6d812c47ff9e"><div class="ttname"><a href="namespaceSayuri.html#a7fb3c6a8d6003ecb91db6d812c47ff9e">Sayuri::RANK_1</a></div><div class="ttdeci">constexpr Rank RANK_1</div><div class="ttdoc">ランク 1 の定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00236">chess_def.h:236</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a11d6a949bb78467349956ec7b5bbe331"><div class="ttname"><a href="namespaceSayuri.html#a11d6a949bb78467349956ec7b5bbe331">Sayuri::KING</a></div><div class="ttdeci">constexpr Piece KING</div><div class="ttdoc">キングの定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00276">chess_def.h:276</a></div></div>
<div class="ttc" id="classSayuri_1_1TTEntry_html_aabcd97fbc778dce0c2bcbc46ede8cd6f"><div class="ttname"><a href="classSayuri_1_1TTEntry.html#aabcd97fbc778dce0c2bcbc46ede8cd6f">Sayuri::TTEntry::mate_in</a></div><div class="ttdeci">int mate_in() const </div><div class="ttdoc">アクセサ - メイトまでの手数。 -1はメイトなし。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00126">transposition_table.h:126</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a62c0e97e6679619161865466bd69060b"><div class="ttname"><a href="namespaceSayuri.html#a62c0e97e6679619161865466bd69060b">Sayuri::MAX_PLYS</a></div><div class="ttdeci">constexpr std::uint32_t MAX_PLYS</div><div class="ttdoc">最大探索手数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00554">chess_def.h:554</a></div></div>
<div class="ttc" id="classSayuri_1_1UCIShell_html_a2d27e96ff6c81cbf61a8dd82738025c6"><div class="ttname"><a href="classSayuri_1_1UCIShell.html#a2d27e96ff6c81cbf61a8dd82738025c6">Sayuri::UCIShell::PrintOtherInfo</a></div><div class="ttdeci">void PrintOtherInfo(Chrono::milliseconds time, std::uint64_t num_nodes, int hashfull)</div><div class="ttdoc">その他の情報を出力する。 </div><div class="ttdef"><b>Definition:</b> <a href="uci__shell_8cpp_source.html#l00267">uci_shell.cpp:267</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a3021cae869ef17e025d33660412a0658"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a3021cae869ef17e025d33660412a0658">Sayuri::ChessEngine::SearchParallel</a></div><div class="ttdeci">void SearchParallel(Job &amp;job)</div><div class="ttdoc">別スレッド用探索関数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l00920">chess_engine_search.cpp:920</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_abacab5219a53c6595be0881aa93c72fa"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#abacab5219a53c6595be0881aa93c72fa">Sayuri::ChessEngine::GetRookAttack</a></div><div class="ttdeci">Bitboard GetRookAttack(Square square) const </div><div class="ttdoc">ボードの状態からルークの利き筋を作る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00191">chess_engine.h:191</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a63e23dda6724e4e676d4374855d6c3ab"><div class="ttname"><a href="namespaceSayuri.html#a63e23dda6724e4e676d4374855d6c3ab">Sayuri::Square</a></div><div class="ttdeci">std::uint32_t Square</div><div class="ttdoc">マスの型。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00084">chess_def.h:84</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a43dc618c4fb77d328fbff1d4f6c0d76e"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a43dc618c4fb77d328fbff1d4f6c0d76e">Sayuri::ChessEngine::GetBishopAttack</a></div><div class="ttdeci">Bitboard GetBishopAttack(Square square) const </div><div class="ttdoc">ボードの状態からビショップの利き筋を作る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00182">chess_engine.h:182</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a337da490a7a423f4da8e94a8b4906da2"><div class="ttname"><a href="namespaceSayuri.html#a337da490a7a423f4da8e94a8b4906da2">Sayuri::Side</a></div><div class="ttdeci">std::uint32_t Side</div><div class="ttdoc">サイドの型。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00253">chess_def.h:253</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ad0caeeb84ca86f74568338ad85644555"><div class="ttname"><a href="classSayuri_1_1Job.html#ad0caeeb84ca86f74568338ad85644555">Sayuri::Job::null_reduction_</a></div><div class="ttdeci">int null_reduction_</div><div class="ttdoc">共有ノードでのNull Move Reductionの結果。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00138">job.h:138</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a1ce75744f6f5181ad0ccd91286933e46"><div class="ttname"><a href="namespaceSayuri.html#a1ce75744f6f5181ad0ccd91286933e46">Sayuri::SCORE_LOSE</a></div><div class="ttdeci">constexpr int SCORE_LOSE</div><div class="ttdoc">負けの評価値。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00509">chess_def.h:509</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a97973d74d3f0792202bde8d652a41f76"><div class="ttname"><a href="namespaceSayuri.html#a97973d74d3f0792202bde8d652a41f76">Sayuri::BLACK</a></div><div class="ttdeci">constexpr Side BLACK</div><div class="ttdoc">黒側の定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00259">chess_def.h:259</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a8ec202eb4942f1adbcfb778141bd9b1a"><div class="ttname"><a href="namespaceSayuri.html#a8ec202eb4942f1adbcfb778141bd9b1a">Sayuri::Bitboard</a></div><div class="ttdeci">std::uint64_t Bitboard</div><div class="ttdoc">ビットボードの型。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00081">chess_def.h:81</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a2f5a30e39ceb33d59e7258e55b1b87a8"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a2f5a30e39ceb33d59e7258e55b1b87a8">Sayuri::ChessEngine::GetNextMyMaterial</a></div><div class="ttdeci">int GetNextMyMaterial(int current_material, Move move) const </div><div class="ttdoc">指定の候補手から次の局面の「自分」のマテリアルを得る。 (「相手」のマテリアルではない。) </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00784">chess_engine.cpp:784</a></div></div>
<div class="ttc" id="classSayuri_1_1Util_html_ade7408eae688017dea24d2291fc285f6"><div class="ttname"><a href="classSayuri_1_1Util.html#ade7408eae688017dea24d2291fc285f6">Sayuri::Util::GetRank</a></div><div class="ttdeci">static Rank GetRank(Square square)</div><div class="ttdoc">マスからランクを得る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__util_8h_source.html#l00551">chess_util.h:551</a></div></div>
<div class="ttc" id="classSayuri_1_1TTEntry_html_a1818c23afb991c0e7d666cd789256c56"><div class="ttname"><a href="classSayuri_1_1TTEntry.html#a1818c23afb991c0e7d666cd789256c56">Sayuri::TTEntry::best_move</a></div><div class="ttdeci">Move best_move() const </div><div class="ttdoc">アクセサ - 最善手。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00121">transposition_table.h:121</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a197c8c14759ad6bc79ba39078287686b"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a197c8c14759ad6bc79ba39078287686b">Sayuri::ChessEngine::job_table_</a></div><div class="ttdeci">std::unique_ptr&lt; Job[]&gt; job_table_</div><div class="ttdoc">並列探索用仕事のテーブル。 [探索レベル] </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00658">chess_engine.h:658</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a93b267327aa045c518c8aa77ae2dd666"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a93b267327aa045c518c8aa77ae2dd666">Sayuri::ChessEngine::SEE</a></div><div class="ttdeci">int SEE(Move move) const </div><div class="ttdoc">SEEで候補手を評価する。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l01419">chess_engine_search.cpp:1419</a></div></div>
<div class="ttc" id="namespaceSayuri_html_abca6f74209e98e45f842b5d13a4f5ff4"><div class="ttname"><a href="namespaceSayuri.html#abca6f74209e98e45f842b5d13a4f5ff4">Sayuri::EN_PASSANT</a></div><div class="ttdeci">constexpr MoveType EN_PASSANT</div><div class="ttdoc">アンパッサンを表す。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00369">chess_def.h:369</a></div></div>
<div class="ttc" id="classSayuri_1_1MoveMaker_html_ae11935acd1aa8933c47299c4b04d1e4d"><div class="ttname"><a href="classSayuri_1_1MoveMaker.html#ae11935acd1aa8933c47299c4b04d1e4d">Sayuri::MoveMaker::RegenMoves</a></div><div class="ttdeci">int RegenMoves()</div><div class="ttdoc">スタックに候補手を再生成する。 </div><div class="ttdef"><b>Definition:</b> <a href="move__maker_8h_source.html#l00111">move_maker.h:111</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a4e62532523cece71e7d0b40433625f0b"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a4e62532523cece71e7d0b40433625f0b">Sayuri::ChessEngine::king_</a></div><div class="ttdeci">Square king_[NUM_SIDES]</div><div class="ttdoc">各サイドのキングの位置。 [サイド] </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00526">chess_engine.h:526</a></div></div>
<div class="ttc" id="namespaceSayuri_html_ab8e43a53c8ed41163b8855c6f68b0793"><div class="ttname"><a href="namespaceSayuri.html#ab8e43a53c8ed41163b8855c6f68b0793">Sayuri::move_to</a></div><div class="ttdeci">Square move_to(Move &amp;move)</div><div class="ttdoc">アクセサ - 移動先の位置。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00385">chess_def.h:385</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a0d5c1ca1621ae1a3c39994a4e007ee4b"><div class="ttname"><a href="namespaceSayuri.html#a0d5c1ca1621ae1a3c39994a4e007ee4b">Sayuri::move_move_type</a></div><div class="ttdeci">MoveType move_move_type(Move &amp;move)</div><div class="ttdoc">アクセサ - 手の種類。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00401">chess_def.h:401</a></div></div>
<div class="ttc" id="uci__shell_8h_html"><div class="ttname"><a href="uci__shell_8h.html">uci_shell.h</a></div><div class="ttdoc">エンジン側のUCIインターフェイス。 </div></div>
<div class="ttc" id="namespaceSayuri_html_afd013b6c13e71dfdc857f0f0576e42bc"><div class="ttname"><a href="namespaceSayuri.html#afd013b6c13e71dfdc857f0f0576e42bc">Sayuri::ROOK</a></div><div class="ttdeci">constexpr Piece ROOK</div><div class="ttdoc">ルークの定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00272">chess_def.h:272</a></div></div>
<div class="ttc" id="classSayuri_1_1Util_html_ab7bc805b9706d690276f4d810c6d9b5f"><div class="ttname"><a href="classSayuri_1_1Util.html#ab7bc805b9706d690276f4d810c6d9b5f">Sayuri::Util::GetPawnAttack</a></div><div class="ttdeci">static Bitboard GetPawnAttack(Square square, Side side)</div><div class="ttdoc">ポーンの攻撃の動きのビットボードを得る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__util_8h_source.html#l00464">chess_util.h:464</a></div></div>
<div class="ttc" id="classSayuri_1_1TranspositionTable_html_a83ac19bead10741ecbb6b0f89c6975b1"><div class="ttname"><a href="classSayuri_1_1TranspositionTable.html#a83ac19bead10741ecbb6b0f89c6975b1">Sayuri::TranspositionTable::GetEntry</a></div><div class="ttdeci">const TTEntry &amp; GetEntry(Hash pos_hash, int depth) const </div><div class="ttdoc">条件を満たすエントリーを得る。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8cpp_source.html#l00125">transposition_table.cpp:125</a></div></div>
<div class="ttc" id="namespaceSayuri_html_af32a3e9ca4a7224599e147c9b4a04ec8"><div class="ttname"><a href="namespaceSayuri.html#af32a3e9ca4a7224599e147c9b4a04ec8">Sayuri::move_promotion</a></div><div class="ttdeci">Piece move_promotion(Move &amp;move)</div><div class="ttdoc">アクセサ - 昇格する駒の種類。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00393">chess_def.h:393</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a433992097fbacc6bfb7c9140cad7ae3e"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a433992097fbacc6bfb7c9140cad7ae3e">Sayuri::ChessEngine::ShouldBeStopped</a></div><div class="ttdeci">bool ShouldBeStopped()</div><div class="ttdoc">探索を中断しなければならないかどうかを判断する。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l01546">chess_engine_search.cpp:1546</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a3808419d4bf7336bc3071533f502f0e0"><div class="ttname"><a href="namespaceSayuri.html#a3808419d4bf7336bc3071533f502f0e0">Sayuri::MAX_NODES</a></div><div class="ttdeci">constexpr std::uint64_t MAX_NODES</div><div class="ttdoc">最大探索ノード数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00557">chess_def.h:557</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_aefee9ac841a17da718d5e3b6af2de709"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#aefee9ac841a17da718d5e3b6af2de709">Sayuri::ChessEngine::MakeMove</a></div><div class="ttdeci">void MakeMove(Move &amp;move)</div><div class="ttdoc">次の一手を指す。 取った駒、動かす前のキャスリングの権利、アンパッサンは 「move」に記録される。 動かす駒の位置と移動先が同じならNull Moveとなる。 (手番が変わる。) 「move」はUnm...</div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00593">chess_engine.cpp:593</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ab2dabf8fe7d35b0e3d4b6cb617361602"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ab2dabf8fe7d35b0e3d4b6cb617361602">Sayuri::ChessEngine::thread_vec_</a></div><div class="ttdeci">std::vector&lt; std::thread &gt; thread_vec_</div><div class="ttdoc">並列探索用スレッドのベクトル。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00662">chess_engine.h:662</a></div></div>
<div class="ttc" id="classSayuri_1_1TTEntry_html_a74f052774cdd9684070eec2dd6d2f22d"><div class="ttname"><a href="classSayuri_1_1TTEntry.html#a74f052774cdd9684070eec2dd6d2f22d">Sayuri::TTEntry::score</a></div><div class="ttdeci">int score() const </div><div class="ttdoc">アクセサ - 評価値。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00111">transposition_table.h:111</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a02f609a81a57ad7473d2f95f0d25475c"><div class="ttname"><a href="classSayuri_1_1Job.html#a02f609a81a57ad7473d2f95f0d25475c">Sayuri::Job::material_</a></div><div class="ttdeci">int material_</div><div class="ttdoc">共有ノードでのマテリアル。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00142">job.h:142</a></div></div>
<div class="ttc" id="classSayuri_1_1Evaluator_html_a3dc6779fd59a6cf84e7c620e16a80d8c"><div class="ttname"><a href="classSayuri_1_1Evaluator.html#a3dc6779fd59a6cf84e7c620e16a80d8c">Sayuri::Evaluator::Evaluate</a></div><div class="ttdeci">int Evaluate(int material)</div><div class="ttdoc">現在の局面の評価値を計算する。 </div><div class="ttdef"><b>Definition:</b> <a href="evaluator_8cpp_source.html#l00103">evaluator.cpp:103</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a38eace0fcb969cf644905fc3ff641791a5fb1f955b45e38e31789286a1790398d"><div class="ttname"><a href="namespaceSayuri.html#a38eace0fcb969cf644905fc3ff641791a5fb1f955b45e38e31789286a1790398d">Sayuri::GenMoveType::ALL</a></div><div class="ttdoc">全ての手。 </div></div>
<div class="ttc" id="namespaceSayuri_html_adfbeb3ac7256015600cf6befea2c0212"><div class="ttname"><a href="namespaceSayuri.html#adfbeb3ac7256015600cf6befea2c0212">Sayuri::Move</a></div><div class="ttdeci">std::uint32_t Move</div><div class="ttdoc">手の型。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00312">chess_def.h:312</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a7140e875d12a2c14b7648bd85978fa03"><div class="ttname"><a href="namespaceSayuri.html#a7140e875d12a2c14b7648bd85978fa03">Sayuri::BISHOP</a></div><div class="ttdeci">constexpr Piece BISHOP</div><div class="ttdoc">ビショップの定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00270">chess_def.h:270</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ae74c358dc27ca27cf13e101e4a132bb6"><div class="ttname"><a href="classSayuri_1_1Job.html#ae74c358dc27ca27cf13e101e4a132bb6">Sayuri::Job::moves_to_search_ptr_</a></div><div class="ttdeci">const std::vector&lt; Move &gt; * moves_to_search_ptr_</div><div class="ttdoc">探索する候補手のベクトルのポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00150">job.h:150</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a7e8b4b7a7a3520176b025bc6776ad9b3"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a7e8b4b7a7a3520176b025bc6776ad9b3">Sayuri::ChessEngine::GetNextHash</a></div><div class="ttdeci">Hash GetNextHash(Hash current_hash, Move move) const </div><div class="ttdoc">現在の局面のハッシュと候補手から、次の局面のハッシュを得る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00831">chess_engine.cpp:831</a></div></div>
<div class="ttc" id="namespaceSayuri_html_aef4f257c997087612c93ac876b79ec63"><div class="ttname"><a href="namespaceSayuri.html#aef4f257c997087612c93ac876b79ec63">Sayuri::NUM_SQUARES</a></div><div class="ttdeci">constexpr Square NUM_SQUARES</div><div class="ttdoc">マスの数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00280">chess_def.h:280</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ab6de10e62ba98e31866ba8fe6d31b083"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ab6de10e62ba98e31866ba8fe6d31b083">Sayuri::ChessEngine::GetMargin</a></div><div class="ttdeci">int GetMargin(int depth)</div><div class="ttdoc">Futility Pruningのマージンを計算する。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l01520">chess_engine_search.cpp:1520</a></div></div>
<div class="ttc" id="classSayuri_1_1TranspositionTable_html_a7be71ee1c0ac1896e45f14abb91f1757"><div class="ttname"><a href="classSayuri_1_1TranspositionTable.html#a7be71ee1c0ac1896e45f14abb91f1757">Sayuri::TranspositionTable::Add</a></div><div class="ttdeci">void Add(Hash pos_hash, int depth, int score, ScoreType score_type, Move best_move, int mate_in)</div><div class="ttdoc">テーブルにエントリーを追加。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8cpp_source.html#l00103">transposition_table.cpp:103</a></div></div>
<div class="ttc" id="namespaceSayuri_html_aff352a02a00ad3809b178628ef75c31f"><div class="ttname"><a href="namespaceSayuri.html#aff352a02a00ad3809b178628ef75c31f">Sayuri::KNIGHT</a></div><div class="ttdeci">constexpr Piece KNIGHT</div><div class="ttdoc">ナイトの定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00268">chess_def.h:268</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a61730bd1bbc2dcca36708950aa8b84b5"><div class="ttname"><a href="classSayuri_1_1Job.html#a61730bd1bbc2dcca36708950aa8b84b5">Sayuri::Job::num_all_moves_</a></div><div class="ttdeci">int num_all_moves_</div><div class="ttdoc">共有ノードでの候補手の数。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00146">job.h:146</a></div></div>
<div class="ttc" id="classSayuri_1_1TTEntry_html_aaa65f55176f09aedcafbbf4279eb606b"><div class="ttname"><a href="classSayuri_1_1TTEntry.html#aaa65f55176f09aedcafbbf4279eb606b">Sayuri::TTEntry::score_type</a></div><div class="ttdeci">ScoreType score_type() const </div><div class="ttdoc">アクセサ - 評価値の種類。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00116">transposition_table.h:116</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a1ed4722c440189e8119f5395d354f679"><div class="ttname"><a href="classSayuri_1_1Job.html#a1ed4722c440189e8119f5395d354f679">Sayuri::Job::delta_ptr_</a></div><div class="ttdeci">int * delta_ptr_</div><div class="ttdoc">共有ノードのデルタ値のポンタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00130">job.h:130</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a08729a5deca223e833840c8b8e224b23"><div class="ttname"><a href="namespaceSayuri.html#a08729a5deca223e833840c8b8e224b23">Sayuri::TimePoint</a></div><div class="ttdeci">SysClock::time_point TimePoint</div><div class="ttdoc">std::chrono::system_clock::time_point の別名。 (長いので短くした。) </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00586">chess_def.h:586</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ae9c1570dcb2d3c19d3ef5d5219e7adfa"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ae9c1570dcb2d3c19d3ef5d5219e7adfa">Sayuri::ChessEngine::IsAttacked</a></div><div class="ttdeci">bool IsAttacked(Square square, Side side) const </div><div class="ttdoc">その位置が他の位置の駒に攻撃されているかどうかチェックする。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00741">chess_engine.cpp:741</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a094a36775a7913ec297ba0a6ba04be39"><div class="ttname"><a href="namespaceSayuri.html#a094a36775a7913ec297ba0a6ba04be39">Sayuri::Hash</a></div><div class="ttdeci">std::uint64_t Hash</div><div class="ttdoc">ハッシュの型。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00503">chess_def.h:503</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ac6c09f71eb8d8e9a6261f39b99b3b6be"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ac6c09f71eb8d8e9a6261f39b99b3b6be">Sayuri::ChessEngine::position_</a></div><div class="ttdeci">Bitboard position_[NUM_SIDES][NUM_PIECE_TYPES]</div><div class="ttdoc">駒の配置のビットボード。 [サイド][駒の種類] </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00510">chess_engine.h:510</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ad73cbf1f5d4e21f57265b0725e174611"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ad73cbf1f5d4e21f57265b0725e174611">Sayuri::ChessEngine::GetMaterial</a></div><div class="ttdeci">int GetMaterial(Side side) const </div><div class="ttdoc">現在のマテリアルを得る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00769">chess_engine.cpp:769</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ab72697ada209d19270bf7dc5f84c79d1"><div class="ttname"><a href="classSayuri_1_1Job.html#ab72697ada209d19270bf7dc5f84c79d1">Sayuri::Job::WaitForHelpers</a></div><div class="ttdeci">void WaitForHelpers()</div><div class="ttdoc">ヘルパーが全員仕事を終えるまで待機する。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8cpp_source.html#l00096">job.cpp:96</a></div></div>
<div class="ttc" id="transposition__table_8h_html"><div class="ttname"><a href="transposition__table_8h.html">transposition_table.h</a></div><div class="ttdoc">トランスポジションテーブル。 </div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a793a9bb952ee1ddee5802208ce533e77"><div class="ttname"><a href="classSayuri_1_1Job.html#a793a9bb952ee1ddee5802208ce533e77">Sayuri::Job::pv_line_ptr_</a></div><div class="ttdeci">PVLine * pv_line_ptr_</div><div class="ttdoc">共有ノードのPVラインのポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00134">job.h:134</a></div></div>
<div class="ttc" id="move__maker_8h_html"><div class="ttname"><a href="move__maker_8h.html">move_maker.h</a></div><div class="ttdoc">候補手を生成するクラス。 </div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a70c08dd04c6981497834f79556d7429f"><div class="ttname"><a href="classSayuri_1_1Job.html#a70c08dd04c6981497834f79556d7429f">Sayuri::Job::next_print_info_time_ptr_</a></div><div class="ttdeci">TimePoint * next_print_info_time_ptr_</div><div class="ttdoc">次にinfoコマンドを送る時間のポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00152">job.h:152</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a42dbbaccf84063521f4820bbe1b1e990"><div class="ttname"><a href="classSayuri_1_1Job.html#a42dbbaccf84063521f4820bbe1b1e990">Sayuri::Job::Count</a></div><div class="ttdeci">int Count()</div><div class="ttdoc">数を数える。 探索した手の数を数えるときに使う。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8cpp_source.html#l00104">job.cpp:104</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ac71b5f96b280ccc2b507742ba47fea24"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ac71b5f96b280ccc2b507742ba47fea24">Sayuri::ChessEngine::mutex_</a></div><div class="ttdeci">std::mutex mutex_</div><div class="ttdoc">並列探索用ミューテックス。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00660">chess_engine.h:660</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_af71ab02647f022503ca25fa4fdad4171"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#af71ab02647f022503ca25fa4fdad4171">Sayuri::ChessEngine::maker_table_</a></div><div class="ttdeci">std::unique_ptr&lt; MoveMaker[]&gt; maker_table_</div><div class="ttdoc">探索用MoveMakerのテーブル。 [探索レベル] </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00652">chess_engine.h:652</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87"><div class="ttname"><a href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a002101f8725e5c78d9f30d87f3fa4c87">Sayuri::ScoreType::ALPHA</a></div><div class="ttdoc">「アルファ値」を表す。 </div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a2667b5609b3ff070c3ddf1e44b8c3c02"><div class="ttname"><a href="classSayuri_1_1Job.html#a2667b5609b3ff070c3ddf1e44b8c3c02">Sayuri::Job::pos_hash_</a></div><div class="ttdeci">Hash pos_hash_</div><div class="ttdoc">共有ノードのハッシュ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00120">job.h:120</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html">Sayuri::ChessEngine</a></div><div class="ttdoc">チェスエンジンの本体クラス。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00061">chess_engine.h:61</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a321ebc22474d5514da19ba2be205ea11"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a321ebc22474d5514da19ba2be205ea11">Sayuri::ChessEngine::UnmakeMove</a></div><div class="ttdeci">void UnmakeMove(Move move)</div><div class="ttdoc">MakeMove()で動かした手を元に戻す。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00686">chess_engine.cpp:686</a></div></div>
<div class="ttc" id="classSayuri_1_1UCIShell_html"><div class="ttname"><a href="classSayuri_1_1UCIShell.html">Sayuri::UCIShell</a></div><div class="ttdoc">UCIのインターフェス。 </div><div class="ttdef"><b>Definition:</b> <a href="uci__shell_8h_source.html#l00123">uci_shell.h:123</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a3f0219a378f20611724f9626aece42c0"><div class="ttname"><a href="classSayuri_1_1Job.html#a3f0219a378f20611724f9626aece42c0">Sayuri::Job::is_checked_</a></div><div class="ttdeci">bool is_checked_</div><div class="ttdoc">共有ノードでチェックされているかどうかのフラグ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00144">job.h:144</a></div></div>
<div class="ttc" id="classSayuri_1_1TranspositionTable_html_a61b2bdb67056b99a2a7cad4c342057ba"><div class="ttname"><a href="classSayuri_1_1TranspositionTable.html#a61b2bdb67056b99a2a7cad4c342057ba">Sayuri::TranspositionTable::GetUsedPermill</a></div><div class="ttdeci">int GetUsedPermill() const </div><div class="ttdoc">使用済みエントリーの占める割合。 (パーミル) </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00227">transposition_table.h:227</a></div></div>
<div class="ttc" id="params_8h_html"><div class="ttname"><a href="params_8h.html">params.h</a></div><div class="ttdoc">探索アルゴリズム、評価関数を変更するパラメータ。 </div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_adbe8c289181aab677aa9fdbd7373db9b"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#adbe8c289181aab677aa9fdbd7373db9b">Sayuri::ChessEngine::piece_board_</a></div><div class="ttdeci">Piece piece_board_[NUM_SQUARES]</div><div class="ttdoc">駒の種類の配置。 [マス] </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00512">chess_engine.h:512</a></div></div>
<div class="ttc" id="classSayuri_1_1PVLine_html_a21e1df968bb412490923bcbe147614a4"><div class="ttname"><a href="classSayuri_1_1PVLine.html#a21e1df968bb412490923bcbe147614a4">Sayuri::PVLine::score</a></div><div class="ttdeci">int score() const </div><div class="ttdoc">アクセサ - 評価値。 </div><div class="ttdef"><b>Definition:</b> <a href="pv__line_8h_source.html#l00112">pv_line.h:112</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ac8fff64162d15c6b7bdfb2575e83d047"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ac8fff64162d15c6b7bdfb2575e83d047">Sayuri::ChessEngine::to_move_</a></div><div class="ttdeci">Side to_move_</div><div class="ttdoc">手番。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00528">chess_engine.h:528</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a558bb7e4ff6ee816782fdddc3c37bc33"><div class="ttname"><a href="classSayuri_1_1Job.html#a558bb7e4ff6ee816782fdddc3c37bc33">Sayuri::Job::record_ptr_</a></div><div class="ttdeci">PositionRecord * record_ptr_</div><div class="ttdoc">クライアントの配置の記録のポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00116">job.h:116</a></div></div>
<div class="ttc" id="classSayuri_1_1TranspositionTable_html"><div class="ttname"><a href="classSayuri_1_1TranspositionTable.html">Sayuri::TranspositionTable</a></div><div class="ttdoc">トランスポジションテーブルのクラス。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00154">transposition_table.h:154</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ab51c5b67b3383c433f81c78f05f2d293"><div class="ttname"><a href="classSayuri_1_1Job.html#ab51c5b67b3383c433f81c78f05f2d293">Sayuri::Job::Init</a></div><div class="ttdeci">void Init(MoveMaker &amp;maker)</div><div class="ttdoc">再初期化。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00086">job.h:86</a></div></div>
<div class="ttc" id="classSayuri_1_1Util_html_afe441f23abf8ab5a1fb336c5ee75c77b"><div class="ttname"><a href="classSayuri_1_1Util.html#afe441f23abf8ab5a1fb336c5ee75c77b">Sayuri::Util::GetKingMove</a></div><div class="ttdeci">static Bitboard GetKingMove(Square square)</div><div class="ttdoc">キングの動きのビットボードを得る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__util_8h_source.html#l00504">chess_util.h:504</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_abf7fa1f0f9379ea036b1ae3049f5ae7b"><div class="ttname"><a href="classSayuri_1_1Job.html#abf7fa1f0f9379ea036b1ae3049f5ae7b">Sayuri::Job::has_legal_move_ptr_</a></div><div class="ttdeci">bool * has_legal_move_ptr_</div><div class="ttdoc">共有ノードで合法手が見つかったかどうかのフラグのポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00148">job.h:148</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a523747ee3b5ff5e302886496216e7083"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a523747ee3b5ff5e302886496216e7083">Sayuri::ChessEngine::GetQueenAttack</a></div><div class="ttdeci">Bitboard GetQueenAttack(Square square) const </div><div class="ttdoc">ボードの状態からクイーンの利き筋を作る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00200">chess_engine.h:200</a></div></div>
<div class="ttc" id="classSayuri_1_1TranspositionTable_html_a086aaf900849e4b5d67384b8d92c7de7"><div class="ttname"><a href="classSayuri_1_1TranspositionTable.html#a086aaf900849e4b5d67384b8d92c7de7">Sayuri::TranspositionTable::Unlock</a></div><div class="ttdeci">void Unlock()</div><div class="ttdoc">トランスポジションテーブルのロックのロックを解除する。。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00234">transposition_table.h:234</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a54db0b050b89681483356f05a9659f6d"><div class="ttname"><a href="classSayuri_1_1Job.html#a54db0b050b89681483356f05a9659f6d">Sayuri::Job::is_null_searching_</a></div><div class="ttdeci">bool is_null_searching_</div><div class="ttdoc">クライアントがNull Search中かどうかのフラグ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00136">job.h:136</a></div></div>
<div class="ttc" id="namespaceSayuri_html_ab844f2804d919a8d48bd02681f1689c5"><div class="ttname"><a href="namespaceSayuri.html#ab844f2804d919a8d48bd02681f1689c5">Sayuri::Piece</a></div><div class="ttdeci">std::uint32_t Piece</div><div class="ttdoc">駒の型。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00262">chess_def.h:262</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a9c0263240cb219b66804754dd71726b2"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a9c0263240cb219b66804754dd71726b2">Sayuri::ChessEngine::is_null_searching_</a></div><div class="ttdeci">bool is_null_searching_</div><div class="ttdoc">今ヌルムーブのサーチ中かどうかのフラグ。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00648">chess_engine.h:648</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ab3eab4889a014d2c5d87a654e300ac15"><div class="ttname"><a href="classSayuri_1_1Job.html#ab3eab4889a014d2c5d87a654e300ac15">Sayuri::Job::node_type_</a></div><div class="ttdeci">NodeType node_type_</div><div class="ttdoc">共有ノードのノードタイプ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00118">job.h:118</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a346cee48d052a7ddc216cd9aa358c13b"><div class="ttname"><a href="classSayuri_1_1Job.html#a346cee48d052a7ddc216cd9aa358c13b">Sayuri::Job::alpha_ptr_</a></div><div class="ttdeci">int * alpha_ptr_</div><div class="ttdoc">共有ノードのアルファ値のポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00126">job.h:126</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a4cdc371480d87aa631fec2bf1318d696"><div class="ttname"><a href="namespaceSayuri.html#a4cdc371480d87aa631fec2bf1318d696">Sayuri::QUEEN</a></div><div class="ttdeci">constexpr Piece QUEEN</div><div class="ttdoc">クイーンの定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00274">chess_def.h:274</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a3a66f2893e3cf5ad92bcc22286da7c34ac41e056424136b6e8c4e23dd6326efa1"><div class="ttname"><a href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34ac41e056424136b6e8c4e23dd6326efa1">Sayuri::ScoreType::EXACT</a></div><div class="ttdoc">「正確な評価値」を表す。 </div></div>
<div class="ttc" id="classSayuri_1_1Job_html_aec295bc1d2ddb9afbdaed175ed64f0fd"><div class="ttname"><a href="classSayuri_1_1Job.html#aec295bc1d2ddb9afbdaed175ed64f0fd">Sayuri::Job::score_type_ptr_</a></div><div class="ttdeci">ScoreType * score_type_ptr_</div><div class="ttdoc">共有ノードの評価値の種類のポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00140">job.h:140</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a2ba2c8d78b32d2a02a1fbefa8c641b1e"><div class="ttname"><a href="classSayuri_1_1Job.html#a2ba2c8d78b32d2a02a1fbefa8c641b1e">Sayuri::Job::depth_</a></div><div class="ttdeci">int depth_</div><div class="ttdoc">共有ノードの深さ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00122">job.h:122</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a8bb1fc13b4ef9f8e9fc8f7a56d60e4d5"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a8bb1fc13b4ef9f8e9fc8f7a56d60e4d5">Sayuri::ChessEngine::GetCurrentHash</a></div><div class="ttdeci">Hash GetCurrentHash() const </div><div class="ttdoc">現在の局面のハッシュを計算する。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00803">chess_engine.cpp:803</a></div></div>
<div class="ttc" id="chess__engine_8h_html"><div class="ttname"><a href="chess__engine_8h.html">chess_engine.h</a></div><div class="ttdoc">チェスエンジンの本体。 </div></div>
<div class="ttc" id="classSayuri_1_1MoveMaker_html_a6bdf60598f4330a006bf8f357f4070ec"><div class="ttname"><a href="classSayuri_1_1MoveMaker.html#a6bdf60598f4330a006bf8f357f4070ec">Sayuri::MoveMaker::PickMove</a></div><div class="ttdeci">Move PickMove()</div><div class="ttdoc">次の候補手を取り出す。 </div><div class="ttdef"><b>Definition:</b> <a href="move__maker_8cpp_source.html#l00138">move_maker.cpp:138</a></div></div>
<div class="ttc" id="namespaceSayuri_html_ad9efed3eea6135b5ec505e10a92c9613"><div class="ttname"><a href="namespaceSayuri.html#ad9efed3eea6135b5ec505e10a92c9613">Sayuri::move_from</a></div><div class="ttdeci">Square move_from(Move &amp;move)</div><div class="ttdoc">アクセサ - 動かす駒の位置。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00377">chess_def.h:377</a></div></div>
<div class="ttc" id="job_8h_html"><div class="ttname"><a href="job_8h.html">job.h</a></div><div class="ttdoc">並列探索用仕事。 </div></div>
<div class="ttc" id="namespaceSayuri_html_a5f7485dc296cbdffd5516fc0615880a4aa565153df227b0510b1c789d5cdc39ec"><div class="ttname"><a href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4aa565153df227b0510b1c789d5cdc39ec">Sayuri::NodeType::PV</a></div><div class="ttdoc">PVノード。 </div></div>
<div class="ttc" id="namespaceSayuri_html_a3a66f2893e3cf5ad92bcc22286da7c34a36b84f8e3fba5bf993e3ba352d62d146"><div class="ttname"><a href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34a36b84f8e3fba5bf993e3ba352d62d146">Sayuri::ScoreType::BETA</a></div><div class="ttdoc">「ベータ値」を表す。 </div></div>
<div class="ttc" id="namespaceSayuri_html_ac2075b4a679c5046b4581194d3c41d77"><div class="ttname"><a href="namespaceSayuri.html#ac2075b4a679c5046b4581194d3c41d77">Sayuri::EqualMove</a></div><div class="ttdeci">bool EqualMove(Move &amp;move_1, Move &amp;move_2)</div><div class="ttdoc">手を比較する。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00498">chess_def.h:498</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_ac79a746bdea1557a507bde436f932fa6"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#ac79a746bdea1557a507bde436f932fa6">Sayuri::ChessEngine::searched_level_</a></div><div class="ttdeci">std::uint32_t searched_level_</div><div class="ttdoc">探索したレベル。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00650">chess_engine.h:650</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a45d63733887697a8101d8b83b46f9497"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a45d63733887697a8101d8b83b46f9497">Sayuri::ChessEngine::SearchRoot</a></div><div class="ttdeci">PVLine SearchRoot(TranspositionTable &amp;table, const std::vector&lt; Move &gt; &amp;moves_to_search, UCIShell &amp;shell)</div><div class="ttdoc">探索のルート。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l00710">chess_engine_search.cpp:710</a></div></div>
<div class="ttc" id="classSayuri_1_1PVLine_html_ab65a4294ffd418442ca321c9b297a19a"><div class="ttname"><a href="classSayuri_1_1PVLine.html#ab65a4294ffd418442ca321c9b297a19a">Sayuri::PVLine::mate_in</a></div><div class="ttdeci">int mate_in() const </div><div class="ttdoc">アクセサ - メイトまでの手数。 -1はメイトなし。 </div><div class="ttdef"><b>Definition:</b> <a href="pv__line_8h_source.html#l00117">pv_line.h:117</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a38eace0fcb969cf644905fc3ff641791ab72f08e0732365cac9599b5c42157bf9"><div class="ttname"><a href="namespaceSayuri.html#a38eace0fcb969cf644905fc3ff641791ab72f08e0732365cac9599b5c42157bf9">Sayuri::GenMoveType::CAPTURE</a></div><div class="ttdoc">駒を取る手。 </div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a1559bc5d9dd8b6f208566fad2d40a9a7"><div class="ttname"><a href="classSayuri_1_1Job.html#a1559bc5d9dd8b6f208566fad2d40a9a7">Sayuri::Job::mutex_ptr_</a></div><div class="ttdeci">std::mutex * mutex_ptr_</div><div class="ttdoc">共有ノード用ミューテックス。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00114">job.h:114</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a603f7001236671f9f6552d6e78719033"><div class="ttname"><a href="namespaceSayuri.html#a603f7001236671f9f6552d6e78719033">Sayuri::SCORE_DRAW</a></div><div class="ttdeci">constexpr int SCORE_DRAW</div><div class="ttdoc">引き分けの評価値。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00511">chess_def.h:511</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html"><div class="ttname"><a href="classSayuri_1_1Job.html">Sayuri::Job</a></div><div class="ttdoc">並列探索用の仕事クラス。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00049">job.h:49</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a6069d68a000c2a664d6530acbe419e88"><div class="ttname"><a href="namespaceSayuri.html#a6069d68a000c2a664d6530acbe419e88">Sayuri::PROMOTION_MASK</a></div><div class="ttdeci">constexpr Move PROMOTION_MASK</div><div class="ttdoc">昇格する駒のマスク。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00344">chess_def.h:344</a></div></div>
<div class="ttc" id="namespaceSayuri_html_af37f7852296b0d09d0c847b0c5e5a05c"><div class="ttname"><a href="namespaceSayuri.html#af37f7852296b0d09d0c847b0c5e5a05c">Sayuri::NORMAL</a></div><div class="ttdeci">constexpr MoveType NORMAL</div><div class="ttdoc">通常の手を表す。 (コマを取らない手。 駒をとる手。) </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00365">chess_def.h:365</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4"><div class="ttname"><a href="namespaceSayuri.html#a5f7485dc296cbdffd5516fc0615880a4a9f3f46bb7a35ba465b170469a1f004c4">Sayuri::NodeType::NON_PV</a></div><div class="ttdoc">PVノードではないノード。 </div></div>
<div class="ttc" id="classSayuri_1_1TTEntry_html"><div class="ttname"><a href="classSayuri_1_1TTEntry.html">Sayuri::TTEntry</a></div><div class="ttdoc">トランスポジションテーブルのエントリー。 </div><div class="ttdef"><b>Definition:</b> <a href="transposition__table_8h_source.html#l00044">transposition_table.h:44</a></div></div>
<div class="ttc" id="classSayuri_1_1UCIShell_html_a965826e93468e8c572cdcfed927ef7e9"><div class="ttname"><a href="classSayuri_1_1UCIShell.html#a965826e93468e8c572cdcfed927ef7e9">Sayuri::UCIShell::PrintPVInfo</a></div><div class="ttdeci">void PrintPVInfo(int depth, int seldepth, int score, Chrono::milliseconds time, std::uint64_t num_nodes, PVLine &amp;pv_line)</div><div class="ttdoc">PVライン情報を出力する。 </div><div class="ttdef"><b>Definition:</b> <a href="uci__shell_8cpp_source.html#l00206">uci_shell.cpp:206</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a45dbc6ce3a8aad524995ca8a2ace1474"><div class="ttname"><a href="namespaceSayuri.html#a45dbc6ce3a8aad524995ca8a2ace1474">Sayuri::PAWN</a></div><div class="ttdeci">constexpr Piece PAWN</div><div class="ttdoc">ポーンの定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00266">chess_def.h:266</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_aa4d1694a6a51ad31ae62c0f2ecd32c1b"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#aa4d1694a6a51ad31ae62c0f2ecd32c1b">Sayuri::ChessEngine::pv_line_table_</a></div><div class="ttdeci">std::unique_ptr&lt; PVLine[]&gt; pv_line_table_</div><div class="ttdoc">探索用PVLineのテーブル。 [探索レベル] </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00654">chess_engine.h:654</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a03be4cdf1a664340c47825a5a074fcba"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a03be4cdf1a664340c47825a5a074fcba">Sayuri::ChessEngine::Quiesce</a></div><div class="ttdeci">int Quiesce(int depth, std::uint32_t level, int alpha, int beta, int material, TranspositionTable &amp;table)</div><div class="ttdoc">クイース探索。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l00055">chess_engine_search.cpp:55</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a52fbdc182f7015fd9069fa616666ee80"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a52fbdc182f7015fd9069fa616666ee80">Sayuri::ChessEngine::Search</a></div><div class="ttdeci">int Search(Hash pos_hash, int depth, std::uint32_t level, int alpha, int beta, int material, TranspositionTable &amp;table)</div><div class="ttdoc">通常の探索。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l00146">chess_engine_search.cpp:146</a></div></div>
<div class="ttc" id="pv__line_8h_html"><div class="ttname"><a href="pv__line_8h.html">pv_line.h</a></div><div class="ttdoc">PVラインを記録するクラス。 </div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a8b31b097bc09387ec19a2603146beedb"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a8b31b097bc09387ec19a2603146beedb">Sayuri::ChessEngine::EnableInfiniteThinking</a></div><div class="ttdeci">void EnableInfiniteThinking(bool enable)</div><div class="ttdoc">無限に思考するかどうかのフラグをセットする。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l01541">chess_engine_search.cpp:1541</a></div></div>
<div class="ttc" id="common_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div><div class="ttdoc">共通で使うヘッダのまとめ。 </div></div>
<div class="ttc" id="classSayuri_1_1MoveMaker_html"><div class="ttname"><a href="classSayuri_1_1MoveMaker.html">Sayuri::MoveMaker</a></div><div class="ttdoc">候補手を生成するクラス。 </div><div class="ttdef"><b>Definition:</b> <a href="move__maker_8h_source.html#l00044">move_maker.h:44</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a2be52e947e9300f51ff75cd165df3869"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a2be52e947e9300f51ff75cd165df3869">Sayuri::ChessEngine::evaluator_</a></div><div class="ttdeci">Evaluator evaluator_</div><div class="ttdoc">探索用Evaluator。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00656">chess_engine.h:656</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ac10d16aa84991f440f8a2837e5831f87"><div class="ttname"><a href="classSayuri_1_1Job.html#ac10d16aa84991f440f8a2837e5831f87">Sayuri::Job::PickMove</a></div><div class="ttdeci">Move PickMove()</div><div class="ttdoc">候補手を得る。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8cpp_source.html#l00078">job.cpp:78</a></div></div>
<div class="ttc" id="classSayuri_1_1PVLine_html_a5f8fb92774ac457ce6c1ec53e684ac2e"><div class="ttname"><a href="classSayuri_1_1PVLine.html#a5f8fb92774ac457ce6c1ec53e684ac2e">Sayuri::PVLine::SetMove</a></div><div class="ttdeci">void SetMove(Move move)</div><div class="ttdoc">初手を挿入する。 </div><div class="ttdef"><b>Definition:</b> <a href="pv__line_8h_source.html#l00077">pv_line.h:77</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a5ecb413f5ccfb0e8b80a7385e90e5e44"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a5ecb413f5ccfb0e8b80a7385e90e5e44">Sayuri::ChessEngine::position</a></div><div class="ttdeci">const Bitboard(&amp; position() const)[NUM_SIDES]</div><div class="ttdoc">アクセサ - 駒の配置のビットボード。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00264">chess_engine.h:264</a></div></div>
<div class="ttc" id="classSayuri_1_1SayuriError_html"><div class="ttname"><a href="classSayuri_1_1SayuriError.html">Sayuri::SayuriError</a></div><div class="ttdoc">Sayuriのエラークラス。 </div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00040">error.h:40</a></div></div>
<div class="ttc" id="classSayuri_1_1PVLine_html_a73d701101df6fc02b7c6267ad9aa43ed"><div class="ttname"><a href="classSayuri_1_1PVLine.html#a73d701101df6fc02b7c6267ad9aa43ed">Sayuri::PVLine::Insert</a></div><div class="ttdeci">void Insert(const PVLine &amp;pv_line)</div><div class="ttdoc">2手目以降を挿入する。 </div><div class="ttdef"><b>Definition:</b> <a href="pv__line_8cpp_source.html#l00092">pv_line.cpp:92</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a31c875494ce32322075dc993f17c101c"><div class="ttname"><a href="classSayuri_1_1Job.html#a31c875494ce32322075dc993f17c101c">Sayuri::Job::level_</a></div><div class="ttdeci">int level_</div><div class="ttdoc">共有ノードのレベル。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00124">job.h:124</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a7301a2506b3ff852c3f1d56ffdfb06fa"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a7301a2506b3ff852c3f1d56ffdfb06fa">Sayuri::ChessEngine::SearchRootParallel</a></div><div class="ttdeci">void SearchRootParallel(Job &amp;job, UCIShell &amp;shell)</div><div class="ttdoc">ルートノードで呼び出される、別スレッド用探索関数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l01166">chess_engine_search.cpp:1166</a></div></div>
<div class="ttc" id="evaluator_8h_html"><div class="ttname"><a href="evaluator_8h.html">evaluator.h</a></div><div class="ttdoc">評価関数クラス。 </div></div>
<div class="ttc" id="namespaceSayuri_html_a3b2f12d45f816ec5a5d1f0a9aa44570e"><div class="ttname"><a href="namespaceSayuri.html#a3b2f12d45f816ec5a5d1f0a9aa44570e">Sayuri::WHITE</a></div><div class="ttdeci">constexpr Side WHITE</div><div class="ttdoc">白側の定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00257">chess_def.h:257</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a700a7b74ce454bde76fb21741f3c2178"><div class="ttname"><a href="namespaceSayuri.html#a700a7b74ce454bde76fb21741f3c2178">Sayuri::NUM_SIDES</a></div><div class="ttdeci">constexpr Side NUM_SIDES</div><div class="ttdoc">サイドの数。(NO_SIDEを含む。) </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00286">chess_def.h:286</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a82185f3c7274880aa4b64d173d84f8e2"><div class="ttname"><a href="namespaceSayuri.html#a82185f3c7274880aa4b64d173d84f8e2">Sayuri::MoveType</a></div><div class="ttdeci">int MoveType</div><div class="ttdoc">手の種類の型。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00361">chess_def.h:361</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a72b90003a30d17b3ed7fa9de58def817"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a72b90003a30d17b3ed7fa9de58def817">Sayuri::ChessEngine::ChessEngine</a></div><div class="ttdeci">ChessEngine()</div><div class="ttdoc">プライベート用コンストラクタ。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8cpp_source.html#l00085">chess_engine.cpp:85</a></div></div>
<div class="ttc" id="classSayuri_1_1PVLine_html"><div class="ttname"><a href="classSayuri_1_1PVLine.html">Sayuri::PVLine</a></div><div class="ttdoc">PVラインを記録するクラス。 </div><div class="ttdef"><b>Definition:</b> <a href="pv__line_8h_source.html#l00040">pv_line.h:40</a></div></div>
<div class="ttc" id="classSayuri_1_1Util_html_a46668b0916f51f6a72bd0e93a9b7652c"><div class="ttname"><a href="classSayuri_1_1Util.html#a46668b0916f51f6a72bd0e93a9b7652c">Sayuri::Util::GetKnightMove</a></div><div class="ttdeci">static Bitboard GetKnightMove(Square square)</div><div class="ttdoc">ナイトの動きのビットボードを得る。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__util_8h_source.html#l00472">chess_util.h:472</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a562c2d8e2d11750772ee83b7909396f8"><div class="ttname"><a href="namespaceSayuri.html#a562c2d8e2d11750772ee83b7909396f8">Sayuri::CAPTURED_PIECE_MASK</a></div><div class="ttdeci">constexpr Move CAPTURED_PIECE_MASK</div><div class="ttdoc">取った駒の種類のマスク。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00348">chess_def.h:348</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ab02c76a312e63b1b35775544032b4541"><div class="ttname"><a href="classSayuri_1_1Job.html#ab02c76a312e63b1b35775544032b4541">Sayuri::Job::client_ptr_</a></div><div class="ttdeci">ChessEngine * client_ptr_</div><div class="ttdoc">クライアントのポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00112">job.h:112</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a3d6d21eb62cdffd512fe4ccddd8511ec"><div class="ttname"><a href="namespaceSayuri.html#a3d6d21eb62cdffd512fe4ccddd8511ec">Sayuri::EMPTY</a></div><div class="ttdeci">constexpr Piece EMPTY</div><div class="ttdoc">どの駒でもない。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00264">chess_def.h:264</a></div></div>
<div class="ttc" id="classSayuri_1_1Util_html_a7da08b551ae4fd7598a801bfdf37cd0f"><div class="ttname"><a href="classSayuri_1_1Util.html#a7da08b551ae4fd7598a801bfdf37cd0f">Sayuri::Util::GetSquare</a></div><div class="ttdeci">static Square GetSquare(Bitboard bitboard)</div><div class="ttdoc">ビットボードからマスを得る。 (A1に最も近いマス。) </div><div class="ttdef"><b>Definition:</b> <a href="chess__util_8h_source.html#l00535">chess_util.h:535</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_af4fe5ed6ef3bc4e62c26c03d20febef6"><div class="ttname"><a href="classSayuri_1_1Job.html#af4fe5ed6ef3bc4e62c26c03d20febef6">Sayuri::Job::FinishMyJob</a></div><div class="ttdeci">void FinishMyJob()</div><div class="ttdoc">仕事終了を知らせる。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8cpp_source.html#l00089">job.cpp:89</a></div></div>
<div class="ttc" id="classSayuri_1_1PositionRecord_html"><div class="ttname"><a href="classSayuri_1_1PositionRecord.html">Sayuri::PositionRecord</a></div><div class="ttdoc">エンジンのボードの状態を記録するクラス。 </div><div class="ttdef"><b>Definition:</b> <a href="position__record_8h_source.html#l00041">position_record.h:41</a></div></div>
<div class="ttc" id="classSayuri_1_1Job_html_a933f4d47a2663f03a1f60322cc2d9f33"><div class="ttname"><a href="classSayuri_1_1Job.html#a933f4d47a2663f03a1f60322cc2d9f33">Sayuri::Job::table_ptr_</a></div><div class="ttdeci">TranspositionTable * table_ptr_</div><div class="ttdoc">トランスポジションテーブルのポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00132">job.h:132</a></div></div>
<div class="ttc" id="position__record_8h_html"><div class="ttname"><a href="position__record_8h.html">position_record.h</a></div><div class="ttdoc">エンジンのボードの状態を記録するクラス。 </div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_abda6ec54e9c9147822e156d4c570a7c0"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#abda6ec54e9c9147822e156d4c570a7c0">Sayuri::ChessEngine::shared_st_ptr_</a></div><div class="ttdeci">std::shared_ptr&lt; SharedStruct &gt; shared_st_ptr_</div><div class="ttdoc">共有メンバの構造体。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine_8h_source.html#l00642">chess_engine.h:642</a></div></div>
<div class="ttc" id="namespaceSayuri_html_ab895b6486924e4bc7a12714b3a55786c"><div class="ttname"><a href="namespaceSayuri.html#ab895b6486924e4bc7a12714b3a55786c">Sayuri::RANK_8</a></div><div class="ttdeci">constexpr Rank RANK_8</div><div class="ttdoc">ランク 8 の定数。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00250">chess_def.h:250</a></div></div>
<div class="ttc" id="classSayuri_1_1ChessEngine_html_a8493ca6e093608182201017c799270d2"><div class="ttname"><a href="classSayuri_1_1ChessEngine.html#a8493ca6e093608182201017c799270d2">Sayuri::ChessEngine::SetStopper</a></div><div class="ttdeci">void SetStopper(std::uint32_t max_depth, std::uint64_t max_nodes, Chrono::milliseconds thinking_time, bool infinite_thinking)</div><div class="ttdoc">探索のストップ条件を設定する。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__engine__search_8cpp_source.html#l01530">chess_engine_search.cpp:1530</a></div></div>
<div class="ttc" id="helper__queue_8h_html"><div class="ttname"><a href="helper__queue_8h.html">helper_queue.h</a></div><div class="ttdoc">並列探索用スレッドのキュー。 </div></div>
<div class="ttc" id="classSayuri_1_1Job_html_ae80b2467e1589747a95a2f61b106bbe8"><div class="ttname"><a href="classSayuri_1_1Job.html#ae80b2467e1589747a95a2f61b106bbe8">Sayuri::Job::beta_ptr_</a></div><div class="ttdeci">int * beta_ptr_</div><div class="ttdoc">共有ノードのベータ値のポインタ。 </div><div class="ttdef"><b>Definition:</b> <a href="job_8h_source.html#l00128">job.h:128</a></div></div>
<div class="ttc" id="namespaceSayuri_html_a3a66f2893e3cf5ad92bcc22286da7c34"><div class="ttname"><a href="namespaceSayuri.html#a3a66f2893e3cf5ad92bcc22286da7c34">Sayuri::ScoreType</a></div><div class="ttdeci">ScoreType</div><div class="ttdoc">評価値の種類。 TTEntry::score_type で使用。 </div><div class="ttdef"><b>Definition:</b> <a href="chess__def_8h_source.html#l00517">chess_def.h:517</a></div></div>
<div class="ttc" id="classSayuri_1_1UCIShell_html_a4ef8124440db52b30af4f3a3222a606b"><div class="ttname"><a href="classSayuri_1_1UCIShell.html#a4ef8124440db52b30af4f3a3222a606b">Sayuri::UCIShell::PrintDepthInfo</a></div><div class="ttdeci">void PrintDepthInfo(int depth)</div><div class="ttdoc">深さ情報を出力する。 </div><div class="ttdef"><b>Definition:</b> <a href="uci__shell_8cpp_source.html#l00242">uci_shell.cpp:242</a></div></div>
<div class="ttc" id="classSayuri_1_1UCIShell_html_a52ecca84266ade437a87e3e0eed51367"><div class="ttname"><a href="classSayuri_1_1UCIShell.html#a52ecca84266ade437a87e3e0eed51367">Sayuri::UCIShell::PrintCurrentMoveInfo</a></div><div class="ttdeci">void PrintCurrentMoveInfo(Move move, int move_num)</div><div class="ttdoc">現在探索している候補手の情報を出力する。 </div><div class="ttdef"><b>Definition:</b> <a href="uci__shell_8cpp_source.html#l00252">uci_shell.cpp:252</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="chess__engine__search_8cpp.html">chess_engine_search.cpp</a></li>
    <li class="footer">Generated on Fri Jun 13 2014 18:43:44 for Sayuri by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
